<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | RenderLine</title>
    <link rel="icon" href="assets/logo.png" type="image/png">
    <meta name="robots" content="noindex, nofollow">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <!-- SortableJS for Drag & Drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <!-- Premium Styles -->
    <link rel="stylesheet" href="admin-style.css">
    <style>
        .hidden {
            display: none !important;
        }

        .service-layout {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        @media(max-width: 600px) {
            .service-layout {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>

    <!-- MOBILE TOGGLE (Floating) -->
    <button class="btn mobile-toggle" onclick="toggleSidebar()">
        <span style="font-size: 1.2rem; color: var(--primary);">‚ò∞</span>
    </button>

    <!-- OVERLAY (Mobile) -->
    <div id="sidebarOverlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:999; display:none;"
        onclick="toggleSidebar()"></div>

    <!-- LOGIN -->
    <div class="login-page" id="loginPage">
        <div class="login-card">
            <h1 style="font-family: 'Cinzel'; color: var(--primary); margin-bottom: 0.5rem; font-size: 2rem;">RenderLine
            </h1>
            <p style="color: var(--text-muted); margin-bottom: 2rem; letter-spacing: 1px;">PREMIUM ADMIN ACCESS</p>

            <div id="loginError" class="btn-danger"
                style="margin-bottom:1rem; padding:0.5rem; display:none; font-size:0.9rem;"></div>

            <form id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="admin@renderline.com" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <span id="loginBtnText">Enter Dashboard</span>
                </button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="adminPanel" style="display:none;">

        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>RenderLine</h2>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-item active" onclick="switchSection('dashboard')">
                    <span class="nav-icon">üìä</span> Dashboard
                </div>
                <div class="nav-item" onclick="switchSection('home')">
                    <span class="nav-icon">üè†</span> Home Page
                </div>
                <div class="nav-item" onclick="switchSection('about')">
                    <span class="nav-icon">üë§</span> About Page
                </div>
                <div class="nav-item" onclick="switchSection('portfolio')">
                    <span class="nav-icon">üñºÔ∏è</span> Portfolio
                </div>
                <div class="nav-item" onclick="switchSection('services')">
                    <span class="nav-icon">‚ú®</span> Services
                </div>
                <div class="nav-item" onclick="switchSection('contact')">
                    <span class="nav-icon">üìû</span> Contact
                </div>
                <div class="nav-item" onclick="switchSection('messages')">
                    <span class="nav-icon">üìß</span> Messages
                </div>
                <div class="nav-item" onclick="switchSection('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span> Settings
                </div>
            </nav>

            <div class="sidebar-footer">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                    <div
                        style="width: 35px; height: 35px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: black; font-weight: bold;">
                        AD</div>
                    <div style="font-size: 0.9rem;">
                        <div style="color: white; font-weight: 500;">Admin</div>
                        <div style="color: var(--text-muted); font-size: 0.8rem;" id="userEmail">access</div>
                    </div>
                </div>
                <button class="btn btn-danger" style="width: 100%; padding: 0.6rem;" onclick="logout()">Logout</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">

            <!-- 1. DASHBOARD -->
            <section id="section-dashboard" class="page-section">
                <div class="page-header">
                    <h1>Dashboard</h1>
                    <p style="color: var(--text-muted);">Welcome back to your control center.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="statPortfolio">--</div>
                        <div style="color: var(--text-muted); font-size: 0.9rem;">Total Projects</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statServices">6</div>
                        <div style="color: var(--text-muted); font-size: 0.9rem;">Active Services</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statMessages">0</div>
                        <div style="color: var(--text-muted); font-size: 0.9rem;">New Inquiries</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h3>üìä Site Analytics & Tracking</h3>
                    <p style="margin-bottom: 1.5rem; color: var(--text-muted);">Monitor your Facebook Pixel, Google Tag
                        Manager, and SEO performance directly.</p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <!-- Facebook Pixel -->
                        <div
                            style="background: rgba(255,255,255,0.03); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                            <div style="color: #4267B2; font-size: 1.5rem; margin-bottom: 0.5rem;">f</div>
                            <h4 style="margin: 0; margin-bottom: 0.5rem; color: #fff;">Facebook Pixel</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">ID:
                                2141726459960922</p>
                            <a href="https://business.facebook.com/events_manager2" target="_blank"
                                class="btn btn-primary" style="font-size: 0.8rem; width: 100%; text-align: center;">View
                                Events</a>
                        </div>

                        <!-- Google Search Console -->
                        <div
                            style="background: rgba(255,255,255,0.03); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                            <div style="color: #F4B400; font-size: 1.5rem; margin-bottom: 0.5rem;">G</div>
                            <h4 style="margin: 0; margin-bottom: 0.5rem; color: #fff;">Google Performance</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">Search Console
                                & SEO</p>
                            <a href="https://search.google.com/search-console" target="_blank" class="btn btn-primary"
                                style="font-size: 0.8rem; width: 100%; text-align: center;">Check Rankings</a>
                        </div>

                        <!-- Google Tag Manager -->
                        <div
                            style="background: rgba(255,255,255,0.03); padding: 1.5rem; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);">
                            <div style="color: #4285F4; font-size: 1.5rem; margin-bottom: 0.5rem;">üè∑Ô∏è</div>
                            <h4 style="margin: 0; margin-bottom: 0.5rem; color: #fff;">Tag Manager</h4>
                            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">ID:
                                GTM-KGJ2VTGV</p>
                            <a href="https://tagmanager.google.com/" target="_blank" class="btn btn-primary"
                                style="font-size: 0.8rem; width: 100%; text-align: center;">Manage Tags</a>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 2rem;">
                    <h3>üöÄ Quick Actions</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="switchSection('portfolio')">üì§ Upload Projects</button>
                        <button class="btn btn-primary" onclick="window.open('index.html', '_blank')"
                            style="background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--border-light);">üëÅÔ∏è
                            View Live Site</button>
                        <button class="btn btn-primary" onclick="switchSection('messages')"
                            style="background: rgba(255,255,255,0.1); color: white; border: 1px solid var(--border-light);">üìß
                            Check Messages</button>
                    </div>
                </div>
            </section>

            <!-- 2. HOME PAGE -->
            <section id="section-home" class="page-section hidden">
                <div class="page-header">
                    <h1>Home Header & Hero</h1>
                </div>

                <div class="card">
                    <h3>Hero Text Content</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Badge Text</label><input type="text" id="heroBadge"></div>
                        <div class="form-group"><label>Line 1 (White)</label><input type="text" id="heroLine1"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Line 2 (White)</label><input type="text" id="heroLine2"></div>
                        <div class="form-group"><label>Line 3 (Gold Accent)</label><input type="text" id="heroLine3">
                        </div>
                    </div>
                    <div class="form-group"><label>Short Description</label><textarea id="heroDesc" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Button 1 Text</label><input type="text" id="heroBtn1"></div>
                        <div class="form-group"><label>Button 2 Text</label><input type="text" id="heroBtn2"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>Hero Carousel Images</h3>
                    <p style="color:var(--text-muted); margin-bottom:1rem; font-size:0.9rem;">Click any image to replace
                        it. Auto-optimizes for web.</p>
                    <div class="image-grid">
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 1)">
                            <img src="assets/images/render2.jpg" id="cloudHero1Preview">
                            <div class="portfolio-actions">Change</div>
                            <input type="file" id="cloudHero1Input" hidden
                                onchange="handleCloudinaryUpload('hero', 1, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 2)">
                            <img src="assets/images/render10.jpg" id="cloudHero2Preview">
                            <div class="portfolio-actions">Change</div>
                            <input type="file" id="cloudHero2Input" hidden
                                onchange="handleCloudinaryUpload('hero', 2, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 3)">
                            <img src="assets/images/render3.jpg" id="cloudHero3Preview">
                            <div class="portfolio-actions">Change</div>
                            <input type="file" id="cloudHero3Input" hidden
                                onchange="handleCloudinaryUpload('hero', 3, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 4)">
                            <img src="assets/images/render12.jpg" id="cloudHero4Preview">
                            <div class="portfolio-actions">Change</div>
                            <input type="file" id="cloudHero4Input" hidden
                                onchange="handleCloudinaryUpload('hero', 4, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 5)">
                            <img src="assets/images/render21.jpg" id="cloudHero5Preview">
                            <div class="portfolio-actions">Change</div>
                            <input type="file" id="cloudHero5Input" hidden
                                onchange="handleCloudinaryUpload('hero', 5, this)">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>"Why Choose Us" & CTA</h3>
                    <div class="form-group"><label>Section Heading</label><input type="text" id="whyHeading"></div>
                    <div class="form-row">
                        <div class="form-group"><label>Feature 1</label><input type="text" id="whyPoint1"></div>
                        <div class="form-group"><label>Feature 2</label><input type="text" id="whyPoint2"></div>
                        <div class="form-group"><label>Feature 3</label><input type="text" id="whyPoint3"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Feature 4</label><input type="text" id="whyPoint4"></div>
                        <div class="form-group"><label>Feature 5</label><input type="text" id="whyPoint5"></div>
                    </div>
                    <div style="height:1px; background:var(--border-light); margin: 2rem 0;"></div>
                    <div class="form-group"><label>CTA Heading</label><input type="text" id="ctaHeading"></div>
                    <div class="form-group"><label>CTA Description</label><textarea id="ctaText" rows="2"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>CTA Button 1</label><input type="text" id="ctaBtn1"></div>
                        <div class="form-group"><label>CTA Button 2</label><input type="text" id="ctaBtn2"></div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveHomeContent()">üíæ Save Home Changes</button>
            </section>

            <!-- 3. ABOUT PAGE -->
            <section id="section-about" class="page-section hidden">
                <div class="page-header">
                    <h1>About Page</h1>
                </div>

                <div class="card">
                    <h3>Profile & Bio</h3>
                    <div class="service-layout">
                        <!-- Use updated class for bigger size -->
                        <div class="image-slot service-thumb" onclick="uploadAboutImage()">
                            <img src="assets/images/dilawar-ali.jpg" id="aboutImagePreview">
                            <div class="portfolio-actions">Upload</div>
                            <input type="file" id="aboutImageInput" hidden onchange="handleAboutImageChange(this)">
                        </div>
                        <div style="flex:1; min-width: 250px;">
                            <div class="form-row">
                                <div class="form-group"><label>Name</label><input type="text" id="aboutName"></div>
                                <div class="form-group"><label>Job Title</label><input type="text" id="aboutTitle">
                                </div>
                            </div>
                            <div class="form-group"><label>Paragraph 1</label><textarea id="aboutBio1"
                                    rows="3"></textarea></div>
                            <div class="form-group"><label>Paragraph 2</label><textarea id="aboutBio2"
                                    rows="3"></textarea></div>
                            <div class="form-group"><label>Paragraph 3</label><textarea id="aboutBio3"
                                    rows="3"></textarea></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Areas of Expertise</h3>
                    <p style="color:var(--text-muted); margin-bottom:1rem;">These appear on the About page grid.</p>

                    <div class="form-group"><label>Section Subtitle</label><input type="text" id="expertiseSubtitle"
                            placeholder="Default: What I Do"></div>

                    <div class="form-row">
                        <div class="form-group"><label>1. Title</label><input type="text" id="expertise1Title"></div>
                        <div class="form-group"><label>1. Desc</label><input type="text" id="expertise1Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>2. Title</label><input type="text" id="expertise2Title"></div>
                        <div class="form-group"><label>2. Desc</label><input type="text" id="expertise2Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>3. Title</label><input type="text" id="expertise3Title"></div>
                        <div class="form-group"><label>3. Desc</label><input type="text" id="expertise3Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>4. Title</label><input type="text" id="expertise4Title"></div>
                        <div class="form-group"><label>4. Desc</label><input type="text" id="expertise4Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>5. Title</label><input type="text" id="expertise5Title"></div>
                        <div class="form-group"><label>5. Desc</label><input type="text" id="expertise5Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>6. Title</label><input type="text" id="expertise6Title"></div>
                        <div class="form-group"><label>6. Desc</label><input type="text" id="expertise6Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>7. Title</label><input type="text" id="expertise7Title"></div>
                        <div class="form-group"><label>7. Desc</label><input type="text" id="expertise7Desc"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>8. Title</label><input type="text" id="expertise8Title"></div>
                        <div class="form-group"><label>8. Desc</label><input type="text" id="expertise8Desc"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>My Workflow (4 Steps)</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Step 1 Title</label><input type="text" id="step1Title"></div>
                        <div class="form-group"><label>Step 1 Desc (About Page)</label><textarea id="step1Desc"
                                rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Step 2 Title</label><input type="text" id="step2Title"></div>
                        <div class="form-group"><label>Step 2 Desc</label><textarea id="step2Desc" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Step 3 Title</label><input type="text" id="step3Title"></div>
                        <div class="form-group"><label>Step 3 Desc</label><textarea id="step3Desc" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Step 4 Title</label><input type="text" id="step4Title"></div>
                        <div class="form-group"><label>Step 4 Desc</label><textarea id="step4Desc" rows="2"></textarea>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Tools & Technologies</h3>
                    <div class="form-group"><label>Section Subtitle</label><input type="text" id="toolsSubtitle"
                            placeholder="Default: My Arsenal"></div>
                    <p style="color:var(--text-muted); font-size:0.9rem;">Comma separated list (e.g. 3ds Max, V-Ray,
                        Unreal Engine)</p>
                    <div class="form-group"><textarea id="toolsList" rows="3"></textarea></div>
                </div>

                <div class="card">
                    <h3>Numbers Stats</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Number of Projects</label><input type="text" id="statProjects">
                        </div>
                        <div class="form-group"><label>Number of Clients</label><input type="text" id="statClients">
                        </div>
                        <div class="form-group"><label>Years Experience</label><input type="text" id="statExperience">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveAboutContent()">üíæ Save About Changes</button>
            </section>

            <!-- 4. PORTFOLIO -->
            <section id="section-portfolio" class="page-section hidden">
                <div class="page-header">
                    <h1>Portfolio Manager</h1>
                </div>

                <div class="card">
                    <h3>Add New Projects</h3>
                    <div class="form-row">
                        <div class="form-group" style="flex:1;">
                            <label>Select Category</label>
                            <select id="portfolioCategoryUpload">
                                <option value="exterior">Exterior Visualization</option>
                                <option value="interior">Interior Visualization</option>
                                <option value="commercial">Commercial Projects</option>
                                <option value="floorplan">3D Floorplans</option>
                            </select>
                        </div>
                    </div>

                    <div class="upload-zone" id="uploadZone">
                        <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--primary);">‚òÅÔ∏è</div>
                        <h4>Drag & Drop Images</h4>
                        <p style="color: var(--text-muted); margin-top:0.5rem;">or click to browse files</p>
                        <input type="file" id="fileInput" multiple hidden>
                    </div>
                    <div id="uploadProgress" style="margin-top: 1rem; font-weight:500; color:var(--primary);"></div>
                </div>

                <div class="card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
                        <h3>Gallery (Drag to Reorder)</h3>
                        <div>
                            <span style="color:var(--text-muted); margin-right:1rem;">Total: <span
                                    id="portfolioCount">0</span></span>
                            <button class="btn btn-primary" onclick="savePortfolioOrder()">üíæ Save Order</button>
                        </div>
                    </div>
                    <div class="portfolio-grid" id="portfolioGrid">
                        <!-- Loaded dynamically -->
                    </div>
                </div>

                <div class="card">
                    <h3>Video Gallery (YouTube)</h3>
                    <div class="form-group"
                        style="background: rgba(255,255,255,0.03); padding: 1.5rem; border-radius: 8px;">
                        <label>Add New Video</label>
                        <div style="display:flex; gap: 10px; flex-wrap: wrap;">
                            <input type="text" id="newVideoUrl" placeholder="Paste YouTube URL here..."
                                oninput="updateVideoPreview(this.value)" style="flex:2; min-width:200px;">
                            <input type="text" id="newVideoTitle" placeholder="Video Title"
                                style="flex:1; min-width:150px;">
                            <button class="btn btn-primary" onclick="addVideoItem()">Add Video</button>
                        </div>
                        <div id="newVideoPreview" style="margin-top: 1rem;"></div>
                    </div>
                    <div id="videoGalleryList" style="display:grid; gap:10px; margin-top:1.5rem;"></div>
                </div>
            </section>

            <!-- 5. SERVICES -->
            <section id="section-services" class="page-section hidden">
                <div class="page-header">
                    <h1>Service Management</h1>
                </div>

                <div class="card">
                    <h3>Services Page Header</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Main Heading</label><input type="text" id="servicesPageHeading">
                        </div>
                        <div class="form-group"><label>Sub Heading</label><input type="text"
                                id="servicesPageSubheading"></div>
                    </div>
                </div>

                <!-- Loop for services 1-6 manually -->
                <script>
                    const servicesList = [
                        { id: 1, title: 'Exterior Visualization' },
                        { id: 2, title: 'Interior Visualization' },
                        { id: 3, title: '3D Animation' },
                        { id: 4, title: 'Floorplan Rendering' },
                        { id: 5, title: 'AutoCAD Drawing' },
                        { id: 6, title: 'Design Consultation' }
                    ];
                    servicesList.forEach(s => document.write(`
                        <div class="card">
                            <h3>Service ${s.id}: ${s.title}</h3>
                            <div class="service-layout">
                                <div class="image-slot service-thumb" onclick="uploadServiceImage(${s.id})">
                                    <img src="assets/images/render${s.id}.jpg" id="service${s.id}ImagePreview">
                                    <div class="portfolio-actions">Change</div>
                                    <input type="file" id="service${s.id}ImageInput" hidden onchange="handleServiceImageChange(${s.id}, this)">
                                </div>
                                <div style="flex:1; min-width:250px;">
                                    <div class="form-row">
                                        <div class="form-group"><label>Service Title</label><input type="text" id="service${s.id}Title"></div>
                                        <div class="form-group"><label>Icon (Emoji)</label><input type="text" id="service${s.id}Icon"></div>
                                    </div>
                                    <div class="form-group"><label>Short Description (Card)</label><textarea id="service${s.id}Short" rows="2"></textarea></div>
                                    <div class="form-group"><label>Long Description (Modal)</label><textarea id="service${s.id}ModalDesc" rows="3"></textarea></div>
                                    <div class="form-row">
                                        <div class="form-group"><label>Starting Price</label><input type="text" id="service${s.id}Price"></div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group"><label>Features (comma list)</label><textarea id="service${s.id}Features" rows="2"></textarea></div>
                                        <div class="form-group"><label>Highlights (comma list)</label><textarea id="service${s.id}Highlights" rows="2"></textarea></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `));
                </script>

                <button class="btn btn-primary" onclick="saveServices()">üíæ Save Services</button>
            </section>

            <!-- 6, 7, 8 (Contact, Messages, Settings) kept same as previous... omitted to save space but included in final write -->
            <!-- 6. CONTACT -->
            <section id="section-contact" class="page-section hidden">
                <div class="page-header">
                    <h1>Contact Info</h1>
                </div>
                <div class="card">
                    <h3>Contact Page</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Heading</label><input type="text" id="contactHeading"></div>
                        <div class="form-group"><label>Subheading</label><input type="text" id="contactSubheading">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Official Email</label><input type="text" id="contactEmail"></div>
                        <div class="form-group"><label>Location</label><input type="text" id="contactLocation"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>WhatsApp (e.g. 923...)</label><input type="text"
                                id="contactWhatsapp"></div>
                        <div class="form-group"><label>Phone Display Text</label><input type="text"
                                id="contactPhoneDisplay"></div>
                    </div>
                </div>
                <!-- Footer here too -->
                <div class="card">
                    <h3>Footer Settings</h3>
                    <div class="form-row">
                        <div class="form-group"><label>Footer Brand Name</label><input type="text" id="footerBrand">
                        </div>
                        <div class="form-group"><label>Footer Tagline</label><input type="text" id="footerTagline">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Copyright Text</label><input type="text" id="footerCopyright">
                        </div>
                        <div class="form-group"><label>Footer Address</label><input type="text" id="footerAddress">
                        </div>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="saveContactContent()">Save Contact</button>
                    <button class="btn btn-primary" onclick="saveFooterContent()">Save Footer</button>
                </div>
            </section>

            <!-- 7. MESSAGES -->
            <section id="section-messages" class="page-section hidden">
                <div class="page-header">
                    <h1>Inquiries</h1>
                </div>
                <div class="card" style="padding:0; overflow-x:auto;">
                    <table style="width:100%; min-width:600px;">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTable">
                            <!-- Loaded via JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 8. SETTINGS -->
            <section id="section-settings" class="page-section hidden">
                <div class="page-header">
                    <h1>System Settings</h1>
                </div>
                <div class="card">
                    <h3>Connection Status</h3>
                    <div class="form-group"><label>Cloud Name</label><input type="text" id="cloudName" readonly
                            value="dzp70azv3" style="color:var(--text-muted);"></div>
                    <div id="connectionStatus" style="margin-top:1rem; color: var(--text-muted);">Initializing...</div>
                </div>
                <div class="card">
                    <h3>Maintenance Tools</h3>
                    <p style="margin-bottom:1rem; color:var(--text-muted); font-size:0.9rem;">Use these only if you need
                        to recover lost data.</p>

                    <div style="display:flex; flex-direction:column; gap:1rem;">
                        <div>
                            <button class="btn btn-primary" onclick="restoreLegacyVideos()"
                                style="width:100%; background:rgba(255,255,255,0.05); border:1px solid var(--border-light); color:white;">‚Ü∫
                                Restore Legacy Videos</button>
                            <div id="restoreLog" style="margin-top:5px; color:#888; font-size:0.85rem;"></div>
                        </div>

                        <div>
                            <button class="btn btn-primary" onclick="migrateLocalAssets()"
                                style="width:100%; background:rgba(255,255,255,0.05); border:1px solid var(--border-light); color:white;">‚òÅÔ∏è
                                Migrate Local Assets to Cloud</button>
                            <div id="migrationLog" style="margin-top:5px; color:#888; font-size:0.85rem;"></div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js?v=3.0"></script>
    <script src="cloudinary-config.js?v=2.0"></script>

    <!-- LOGIC -->
    <script>
        // --- RESPONSIVE TOGGLE ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');

            if (sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
                if (overlay) overlay.style.display = 'none';
            } else {
                sidebar.classList.add('active');
                if (overlay) overlay.style.display = 'block';
            }
        }

        // --- CORE NAVIGATION & LOGIC ---

        let currentUser = null;
        let pOrder = []; // To store portfolio order

        // --- 1. LOGIN ---
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const btnText = document.getElementById('loginBtnText');

            btnText.innerText = "Authenticating...";
            errorDiv.style.display = 'none';

            if (typeof isSupabaseConfigured === 'function' && isSupabaseConfigured()) {
                const { data, error } = await adminLogin(email, password);
                if (error) {
                    errorDiv.innerText = error.message;
                    errorDiv.style.display = 'block';
                    btnText.innerText = "Enter Dashboard";
                } else {
                    enterAdmin(data.user);
                }
            } else {
                setTimeout(() => enterAdmin({ email: email }), 800);
            }
        });

        function enterAdmin(user) {
            currentUser = user;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            if (document.getElementById('userEmail')) document.getElementById('userEmail').innerText = user.email;
            loadDashboard();
        }

        function logout() {
            if (typeof adminLogout === 'function') adminLogout();
            location.reload();
        }

        // --- 2. NAVIGATION ---
        function switchSection(id) {
            if (window.innerWidth <= 768) toggleSidebar();

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const nav = document.querySelector(`.nav-item[onclick="switchSection('${id}')"]`);
            if (nav) nav.classList.add('active');

            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
            const section = document.getElementById('section-' + id);
            if (section) section.classList.remove('hidden');
        }

        // --- 3. DATA LOADING ---
        async function loadDashboard() {
            console.log("Loading Dashboard Data...");

            if (typeof getSiteContent === 'function') {
                const { data: content } = await getSiteContent();
                if (content) {
                    // LOAD PORTFOLIO ORDER
                    if (content.portfolio_order) {
                        try { pOrder = JSON.parse(content.portfolio_order); } catch (e) { }
                    }

                    // Home
                    setVal('heroBadge', content.hero_badge);
                    setVal('heroLine1', content.hero_line1);
                    setVal('heroLine2', content.hero_line2);
                    setVal('heroLine3', content.hero_line3);
                    setVal('heroDesc', content.hero_description);
                    setVal('heroBtn1', content.hero_btn1_text);
                    setVal('heroBtn2', content.hero_btn2_text);

                    for (let i = 1; i <= 5; i++) {
                        if (content['cloudinary_hero' + i]) setSrc('cloudHero' + i + 'Preview', content['cloudinary_hero' + i]);
                    }

                    // About
                    setVal('aboutName', content.about_name);
                    setVal('aboutTitle', content.about_title);
                    setVal('aboutBio1', content.about_bio1);
                    setVal('aboutBio2', content.about_bio2);
                    setVal('aboutBio3', content.about_bio3);
                    setSrc('aboutImagePreview', content.about_image);

                    // Stats
                    setVal('statProjects', content.stat_projects);
                    setVal('statClients', content.stat_clients);
                    setVal('statExperience', content.stat_experience);

                    // Process Steps (My Workflow)
                    setVal('step1Title', content.step1_title);
                    setVal('step1Desc', content.step1_desc);
                    setVal('step2Title', content.step2_title);
                    setVal('step2Desc', content.step2_desc);
                    setVal('step3Title', content.step3_title);
                    setVal('step3Desc', content.step3_desc);
                    setVal('step4Title', content.step4_title);
                    setVal('step4Desc', content.step4_desc);

                    // Tools
                    setVal('toolsList', content.tools_list || '3ds Max, V-Ray, Corona Renderer, Lumion, D5 Render, Unreal Engine 5, Enscape, Twinmotion, AutoCAD, SketchUp, Revit, Blender, Photoshop, After Effects, AI Tools');

                    // Expertise Defaults
                    const expertiseDefaults = [
                        { t: 'Exterior Visualization', d: 'Villas, towers, facades' },
                        { t: 'Interior Design', d: 'Luxury residential & commercial' },
                        { t: '3D Walkthroughs', d: 'Cinematic animations' },
                        { t: 'Aerial & Drone Views', d: "Bird's eye perspectives" },
                        { t: 'Night & Dusk Scenes', d: 'Dramatic lighting' },
                        { t: 'Commercial Spaces', d: 'Offices, retail, hotels' },
                        { t: 'Floor Plans', d: '2D & 3D layouts' },
                        { t: 'Real Estate Marketing', d: 'Sales-ready visuals' }
                    ];

                    // Expertise
                    for (let i = 1; i <= 8; i++) {
                        setVal('expertise' + i + 'Title', content['expertise' + i + '_title'] || expertiseDefaults[i - 1].t);
                        setVal('expertise' + i + 'Desc', content['expertise' + i + '_desc'] || expertiseDefaults[i - 1].d);
                    }

                    // Subtitles
                    setVal('expertiseSubtitle', content.expertise_subtitle || 'What I Do');
                    setVal('toolsSubtitle', content.tools_subtitle || 'My Arsenal');



                    // Why/CTA
                    setVal('whyHeading', content.why_heading);
                    setVal('whyPoint1', content.why_point1);
                    setVal('whyPoint2', content.why_point2);
                    setVal('whyPoint3', content.why_point3);
                    setVal('whyPoint4', content.why_point4);
                    setVal('whyPoint5', content.why_point5);
                    setVal('ctaHeading', content.cta_heading);
                    setVal('ctaText', content.cta_text);
                    setVal('ctaBtn1', content.cta_btn1_text);
                    setVal('ctaBtn2', content.cta_btn2_text);

                    // Services
                    setVal('servicesPageHeading', content.services_heading);
                    setVal('servicesPageSubheading', content.services_subheading);
                    for (let i = 1; i <= 6; i++) {
                        setVal('service' + i + 'Title', content['service' + i + '_title']);
                        setVal('service' + i + 'Icon', content['service' + i + '_icon']);
                        setVal('service' + i + 'Short', content['service' + i + '_desc']);
                        setVal('service' + i + 'ModalDesc', content['service' + i + '_modal_desc']);
                        setVal('service' + i + 'Price', content['service' + i + '_price']);
                        setVal('service' + i + 'Features', content['service' + i + '_features']);
                        setVal('service' + i + 'Highlights', content['service' + i + '_highlights']);
                        if (content['cloudinary_service' + i]) setSrc('service' + i + 'ImagePreview', content['cloudinary_service' + i]);
                    }

                    // Contact/Footer
                    setVal('contactHeading', content.contact_heading);
                    setVal('contactSubheading', content.contact_subheading);
                    setVal('contactEmail', content.contact_email);
                    setVal('contactWhatsapp', content.contact_whatsapp);
                    setVal('contactLocation', content.contact_location);
                    setVal('contactPhoneDisplay', content.contact_phone_display);

                    setVal('footerBrand', content.footer_brand);
                    setVal('footerTagline', content.footer_tagline);
                    setVal('footerCopyright', content.footer_copyright);
                    setVal('footerAddress', content.contact_location);
                    setVal('footerPhone', content.contact_phone_display);
                }
            }

            loadPortfolioGrid();
            loadVideoGallery();

            if (typeof getContactMessages === 'function') {
                const { data: msgs } = await getContactMessages();
                const tbody = document.getElementById('messagesTable');
                tbody.innerHTML = '';
                if (msgs && msgs.length > 0) {
                    document.getElementById('statMessages').innerText = msgs.filter(m => m.status === 'new').length;
                    msgs.forEach(m => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${m.name}</td>
                            <td>${m.email}</td>
                            <td><span style="color:${m.status === 'new' ? 'var(--primary)' : '#888'}">${m.status}</span></td>
                            <td><a href="mailto:${m.email}" style="color:var(--text-main); text-decoration:none; border-bottom:1px solid var(--primary);">Reply</a></td>
                        `;
                        tbody.appendChild(tr);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="4" style="padding:1rem; text-align:center; color:var(--text-muted);">No messages found.</td></tr>';
                }
            }

            document.getElementById('connectionStatus').innerText = "‚úÖ System Online";
        }

        // --- HELPERS ---
        function setVal(id, val) { if (document.getElementById(id) && val) document.getElementById(id).value = val; }
        function setSrc(id, val) { if (document.getElementById(id) && val) document.getElementById(id).src = val; }

        // --- 4. PORTFOLIO LOGIC ---
        async function loadPortfolioGrid() {
            let items = [];
            if (typeof getPortfolioItems === 'function' && isSupabaseConfigured()) {
                const { data } = await getPortfolioItems();
                if (data) items = data;
            } else {
                items = JSON.parse(localStorage.getItem('portfolio_items') || '[]');
            }

            // SORT Items based on pOrder
            if (pOrder && pOrder.length > 0) {
                items.sort((a, b) => {
                    const idxA = pOrder.indexOf(a.id);
                    const idxB = pOrder.indexOf(b.id);
                    // If both found, sort by index. If not found, put at end.
                    if (idxA === -1 && idxB === -1) return 0;
                    if (idxA === -1) return 1;
                    if (idxB === -1) return -1;
                    return idxA - idxB;
                });
            }

            document.getElementById('statPortfolio').innerText = items.length;
            document.getElementById('portfolioCount').innerText = items.length;

            const grid = document.getElementById('portfolioGrid');
            grid.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'portfolio-item';
                div.setAttribute('data-id', item.id); // for sortable
                div.innerHTML = `
                    <img src="${item.image_url}" loading="lazy">
                    <div class="portfolio-actions">
                        <button class="btn btn-danger" onclick="deletePortfolioItemWrapper('${item.id}')">Delete</button>
                    </div>
                 `;
                grid.appendChild(div);
            });

            // INIT SORTABLE JS
            new Sortable(grid, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag'
            });
        }

        async function savePortfolioOrder() {
            const order = [];
            document.querySelectorAll('.portfolio-item').forEach(el => {
                order.push(parseInt(el.getAttribute('data-id')));
            });
            await updateSiteContent({ portfolio_order: JSON.stringify(order) });
            alert("Order Saved!");
        }

        async function deletePortfolioItemWrapper(id) {
            if (!confirm("Delete this item?")) return;
            if (typeof deletePortfolioItem === 'function' && isSupabaseConfigured()) {
                await deletePortfolioItem(id);
            } else {
                let items = JSON.parse(localStorage.getItem('portfolio_items') || '[]');
                items = items.filter(x => x.id != id);
                localStorage.setItem('portfolio_items', JSON.stringify(items));
            }
            loadPortfolioGrid();
        }

        // Drag & Drop Upload
        const dropZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.style.background = 'var(--primary-dim)'; };
        dropZone.ondragleave = () => { dropZone.style.background = 'rgba(255,255,255,0.01)'; };
        dropZone.ondrop = (e) => { e.preventDefault(); handleUpload(e.dataTransfer.files); };
        fileInput.onchange = (e) => handleUpload(e.target.files);

        async function handleUpload(files) {
            const progress = document.getElementById('uploadProgress');
            const category = document.getElementById('portfolioCategoryUpload').value;
            progress.innerHTML = 'Uploading...';

            for (let file of files) {
                if (typeof uploadToCloudinary === 'function') {
                    const { data, error } = await uploadToCloudinary(file, 'portfolio');
                    if (data) {
                        const newItem = {
                            title: file.name,
                            image_url: data.url,
                            public_id: data.publicId,
                            category: category
                        };
                        // Save DB
                        if (isSupabaseConfigured()) {
                            await addPortfolioItem(newItem);
                        } else {
                            let items = JSON.parse(localStorage.getItem('portfolio_items') || '[]');
                            newItem.id = Date.now();
                            items.push(newItem);
                            localStorage.setItem('portfolio_items', JSON.stringify(items));
                        }
                    }
                }
            }
            progress.innerHTML = 'Upload Complete!';
            loadPortfolioGrid();
        }

        // --- 5. CLOUDINARY DIRECT HELPERS (Hero/Services) ---
        function uploadCloudinaryImage(type, index) {
            document.getElementById(type === 'hero' ? `cloudHero${index}Input` : `service${index}ImageInput`).click();
        }

        async function handleCloudinaryUpload(type, index, input) {
            if (!input.files[0]) return;
            const file = input.files[0];
            // Preview
            const reader = new FileReader();
            reader.onload = (e) => document.getElementById((type === 'hero' ? 'cloudHero' : type) + index + 'Preview').src = e.target.result;
            reader.readAsDataURL(file);

            // Upload
            if (typeof uploadToCloudinary === 'function') {
                const { data } = await uploadToCloudinary(file, 'static_assets');
                if (data) {
                    // Save to DB
                    const field = (type === 'hero') ? `cloudinary_hero${index}` : `cloudinary_${type}${index}`;
                    if (isSupabaseConfigured()) {
                        updateSiteContent({ [field]: data.url });
                    }
                    alert("Uploaded & Saved!");
                }
            }
        }

        async function uploadAboutImage() { document.getElementById('aboutImageInput').click(); }
        async function handleAboutImageChange(input) {
            if (!input.files[0]) return;
            const file = input.files[0];
            const { data } = await uploadToCloudinary(file, 'profile');
            if (data) {
                document.getElementById('aboutImagePreview').src = data.url;
                updateSiteContent({ about_image: data.url });
            }
        }

        // Service Images
        function uploadServiceImage(i) { document.getElementById('service' + i + 'ImageInput').click(); }
        async function handleServiceImageChange(i, input) {
            if (!input.files[0]) return;
            const file = input.files[0];
            const { data } = await uploadToCloudinary(file, 'services');
            if (data) {
                document.getElementById('service' + i + 'ImagePreview').src = data.url;
                updateSiteContent({ ['cloudinary_service' + i]: data.url });
            }
        }

        // --- 6. SAVE FUNCTIONS ---
        async function saveHomeContent() {
            const data = {
                hero_badge: document.getElementById('heroBadge').value,
                hero_line1: document.getElementById('heroLine1').value,
                hero_line2: document.getElementById('heroLine2').value,
                hero_line3: document.getElementById('heroLine3').value,
                hero_description: document.getElementById('heroDesc').value,
                hero_btn1_text: document.getElementById('heroBtn1').value,
                hero_btn2_text: document.getElementById('heroBtn2').value,
                why_heading: document.getElementById('whyHeading').value,
                why_point1: document.getElementById('whyPoint1').value,
                why_point2: document.getElementById('whyPoint2').value,
                why_point3: document.getElementById('whyPoint3').value,
                why_point4: document.getElementById('whyPoint4').value,
                why_point5: document.getElementById('whyPoint5').value,
                cta_heading: document.getElementById('ctaHeading').value,
                cta_text: document.getElementById('ctaText').value,
                cta_btn1_text: document.getElementById('ctaBtn1').value,
                cta_btn2_text: document.getElementById('ctaBtn2').value
            };
            await updateSiteContent(data);
            alert("Home Page Saved!");
        }

        async function saveAboutContent() {
            const data = {
                about_name: document.getElementById('aboutName').value,
                about_title: document.getElementById('aboutTitle').value,
                about_bio1: document.getElementById('aboutBio1').value,
                about_bio2: document.getElementById('aboutBio2').value,
                about_bio3: document.getElementById('aboutBio3').value,
                stat_projects: document.getElementById('statProjects').value,
                stat_clients: document.getElementById('statClients').value,
                stat_experience: document.getElementById('statExperience').value,
                // Steps
                step1_title: document.getElementById('step1Title').value,
                step1_desc: document.getElementById('step1Desc').value,
                step2_title: document.getElementById('step2Title').value,
                step2_desc: document.getElementById('step2Desc').value,
                step3_title: document.getElementById('step3Title').value,
                step3_desc: document.getElementById('step3Desc').value,
                step4_title: document.getElementById('step4Title').value,
                step4_desc: document.getElementById('step4Desc').value,
                tools_list: document.getElementById('toolsList').value,

                // New Subtitles
                expertise_subtitle: document.getElementById('expertiseSubtitle').value,
                tools_subtitle: document.getElementById('toolsSubtitle').value,
            };

            // Collect 8 Expertise
            for (let i = 1; i <= 8; i++) {
                data['expertise' + i + '_title'] = document.getElementById('expertise' + i + 'Title').value;
                data['expertise' + i + '_desc'] = document.getElementById('expertise' + i + 'Desc').value;
            }

            await updateSiteContent(data);
            alert("About Page Saved!");
        }

        async function saveServices() {
            const data = {
                services_heading: document.getElementById('servicesPageHeading').value,
                services_subheading: document.getElementById('servicesPageSubheading').value
            };
            // Save Services (6 cards)
            for (let i = 1; i <= 6; i++) {
                data['service' + i + '_title'] = document.getElementById('service' + i + 'Title').value;
                data['service' + i + '_icon'] = document.getElementById('service' + i + 'Icon').value;
                data['service' + i + '_desc'] = document.getElementById('service' + i + 'Short').value;
                data['service' + i + '_modal_desc'] = document.getElementById('service' + i + 'ModalDesc').value; // NEW
                data['service' + i + '_price'] = document.getElementById('service' + i + 'Price').value;
                data['service' + i + '_features'] = document.getElementById('service' + i + 'Features').value;
                data['service' + i + '_highlights'] = document.getElementById('service' + i + 'Highlights').value; // NEW
            }
            await updateSiteContent(data);
            alert("Services Saved!");
        }

        async function saveContactContent() {
            const data = {
                contact_heading: document.getElementById('contactHeading').value,
                contact_subheading: document.getElementById('contactSubheading').value,
                contact_email: document.getElementById('contactEmail').value,
                contact_whatsapp: document.getElementById('contactWhatsapp').value,
                contact_location: document.getElementById('contactLocation').value,
                contact_phone_display: document.getElementById('contactPhoneDisplay').value
            };
            await updateSiteContent(data);
            alert("Contact Info Updated!");
        }

        async function saveFooterContent() {
            const data = {
                footer_brand: document.getElementById('footerBrand').value,
                footer_tagline: document.getElementById('footerTagline').value,
                footer_copyright: document.getElementById('footerCopyright').value
            };
            await updateSiteContent(data);
            alert("Footer Updated!");
        }

        // --- 7. VIDEO GALLERY ---
        async function loadVideoGallery() {
            const list = document.getElementById('videoGalleryList');
            if (!list) return;
            // Using Supabase 'site_videos' table
            const { data, error } = await supabaseDb.from('site_videos').select('*');
            list.innerHTML = '';
            if (data) {
                data.forEach(vid => {
                    const div = document.createElement('div');
                    div.className = 'form-group';
                    div.style.background = 'rgba(255,255,255,0.02)';
                    div.style.padding = '0.75rem';
                    div.style.border = '1px solid var(--border-light)';
                    div.style.borderRadius = '8px';
                    div.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-weight:500;">${vid.title || 'Video'}</span>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <a href="${vid.video_url}" target="_blank" style="color:var(--text-muted); font-size:0.8rem; text-decoration:none;">View</a>
                            <button class="btn btn-danger" onclick="deleteVideo('${vid.id}')" style="padding:0.25rem 0.5rem; font-size:0.8rem;">Delete</button>
                        </div>
                     </div>`;
                    list.appendChild(div);
                });
            }
        }

        async function addVideoItem() {
            const url = document.getElementById('newVideoUrl').value;
            const title = document.getElementById('newVideoTitle').value;
            if (!url) return;
            await supabaseDb.from('site_videos').insert([{ video_url: url, title: title }]);
            loadVideoGallery();
            document.getElementById('newVideoUrl').value = '';
        }

        async function deleteVideo(id) {
            if (!confirm("Delete?")) return;
            await supabaseDb.from('site_videos').delete().eq('id', id);
            loadVideoGallery();
        }

        function updateVideoPreview(url) {
            const id = url.match(/(?:youtu\.be\/|youtube\.com\/watch\?v=)([^&]+)/);
            if (id) {
                document.getElementById('newVideoPreview').innerHTML = `<iframe width="200" height="110" src="https://www.youtube.com/embed/${id[1]}" frameborder="0"></iframe>`;
            }
        }

        // --- 8. MIGRATION TOOLS (Keep intact) ---
        async function restoreLegacyVideos() {
            const log = document.getElementById('restoreLog');
            log.innerText = "Checking localStorage...";

            try {
                const storedVideos = JSON.parse(localStorage.getItem('my_portfolio_videos') || '[]');
                if (storedVideos.length === 0) {
                    log.innerText = "No videos found.";
                    return;
                }
                let success = 0;
                for (let vid of storedVideos) {
                    await supabaseDb.from('site_videos').insert([{ video_url: vid.url, title: vid.title }]);
                    success++;
                }
                log.innerText = `Restored ${success} videos.`;
                loadVideoGallery();
            } catch (e) { log.innerText = "Error: " + e.message; }
        }

        async function migrateLocalAssets() {
            // Same as before
            const log = document.getElementById('migrationLog');
            log.innerText = "Starting migration...";
            if (!confirm("Upload ALL local items?")) return;
            const items = JSON.parse(localStorage.getItem('portfolio_items') || '[]');
            if (items.length === 0) { log.innerText = "No items."; return; }
            let success = 0;
            for (let item of items) {
                if (item.image_url && item.image_url.includes('cloudinary')) continue;
                if (item.image_url && item.image_url.startsWith('data:')) {
                    const res = await fetch(item.image_url);
                    const blob = await res.blob();
                    const file = new File([blob], item.title + ".jpg", { type: "image/jpeg" });
                    const { data } = await uploadToCloudinary(file, 'portfolio');
                    if (data) {
                        await addPortfolioItem({
                            title: item.title,
                            category: item.category || 'exterior',
                            image_url: data.url,
                            public_id: data.publicId
                        });
                        success++;
                    }
                }
                log.innerText = `Migrated ${success} / ${items.length}`;
            }
            log.innerText = `Complete. ${success} moved.`;
            loadPortfolioGrid();
        }

        // --- 9. AUTO-INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            window.setTimeout(async () => {
                if (typeof isLoggedIn === 'function' && await isLoggedIn()) {
                    const user = await getCurrentUser();
                    enterAdmin(user);
                }
            }, 500);
        });

    </script>
</body>

</html>