<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - RenderLine</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" href="admin-style.css?v=3.0">
</head>

<body>

    <!-- LOGIN PAGE -->
    <div class="login-page" id="loginPage">
        <div class="login-container">
            <div class="login-logo">
                <h1>RenderLine</h1>
                <p>Admin Access</p>
            </div>

            <div class="error-msg" id="loginError"></div>

            <form id="loginForm">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" placeholder="admin@renderline.com" required>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>

                <button type="submit" class="btn btn-primary">
                    <span id="loginBtnText">Sign In</span>
                </button>
            </form>
        </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div class="admin-wrapper" id="adminPanel">
        <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>RenderLine</h2>
                <p>Admin Panel</p>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section-title">Main</div>
                <div class="nav-item active" data-section="dashboard">
                    <span class="nav-icon">ðŸ“Š</span>
                    <span>Dashboard</span>
                </div>

                <div class="nav-section-title">Pages</div>
                <div class="nav-item" data-section="home">
                    <span class="nav-icon">ðŸ </span>
                    <span>Home Page</span>
                </div>
                <div class="nav-item" data-section="about">
                    <span class="nav-icon">ðŸ‘¤</span>
                    <span>About Page</span>
                </div>
                <div class="nav-item" data-section="portfolio">
                    <span class="nav-icon">ðŸ–¼ï¸</span>
                    <span>Portfolio</span>
                </div>
                <div class="nav-item" data-section="services">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Services</span>
                </div>
                <div class="nav-item" data-section="contact">
                    <span class="nav-icon">ðŸ“ž</span>
                    <span>Contact Page</span>
                </div>
                <div class="nav-item" data-section="footer">
                    <span class="nav-icon">ðŸ“</span>
                    <span>Footer</span>
                </div>

                <div class="nav-section-title">Management</div>
                <div class="nav-item" data-section="messages">
                    <span class="nav-icon">ðŸ“§</span>
                    <span>Messages</span>
                </div>
                <div class="nav-item" data-section="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Settings</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">DA</div>
                    <div class="user-details">
                        <h4>Dilawar Ali</h4>
                        <p id="userEmail">admin@renderline.com</p>
                    </div>
                </div>
                <button class="btn btn-logout" onclick="logout()">Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">
                <span style="font-size: 1.2rem;">â˜°</span> Menu
            </button>

            <!-- Dashboard Section -->
            <!-- Dashboard Section -->
            <section id="section-dashboard" class="section active">
                <div class="page-header">
                    <h1>Dashboard Overview</h1>
                    <p style="color: var(--text-dim);">Real-time insights and analytics for your business.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card glass-card delay-1">
                        <div class="stat-icon-wrapper">
                            <span class="stat-icon">ðŸ‘¥</span>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="statVisitors">14</div>
                            <div class="stat-label">Live Visitors</div>
                            <div class="stat-trend success">â†‘ Now</div>
                        </div>
                    </div>
                    <div class="stat-card glass-card delay-2">
                        <div class="stat-icon-wrapper">
                            <span class="stat-icon">ðŸ‘ï¸</span>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="statViews">--</div>
                            <div class="stat-label">Total Views</div>
                            <div class="stat-trend success">â†‘ 12% vs last week</div>
                        </div>
                    </div>
                    <div class="stat-card glass-card delay-3">
                        <div class="stat-icon-wrapper">
                            <span class="stat-icon">ðŸ“ˆ</span>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="statConversion">3.5%</div>
                            <div class="stat-label">Client Conversion</div>
                            <div class="stat-trend warning">Target: 5%</div>
                        </div>
                    </div>
                    <div class="stat-card glass-card delay-4">
                        <div class="stat-icon-wrapper">
                            <span class="stat-icon">ðŸ“§</span>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="statMessages">0</div>
                            <div class="stat-label">New Messages</div>
                            <div class="stat-trend success">Active Leads</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-grid">
                    <div class="card glass-card chart-container">
                        <div class="card-header">
                            <h3>Visitor Traffic</h3>
                            <span class="badge badge-new">Live</span>
                        </div>
                        <canvas id="trafficChart"></canvas>
                    </div>
                    <div class="card glass-card chart-container">
                        <div class="card-header">
                            <h3>Device Breakdown</h3>
                        </div>
                        <canvas id="deviceChart"></canvas>
                    </div>
                </div>

                <div class="card glass-card mt-4">
                    <h3>Quick Actions</h3>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="switchSection('portfolio')">ðŸ“¸ Upload Project</button>
                        <button class="btn btn-secondary" onclick="switchSection('messages')">ðŸ“§ Check Messages</button>
                        <button class="btn btn-outline" onclick="window.open('index.html', '_blank')">ðŸ‘ï¸ View
                            Website</button>
                    </div>
                </div>
            </section>

            <!-- Home Page Section -->
            <section id="section-home" class="section">
                <div class="page-header">
                    <h1>Home Page Content</h1>
                    <p>Manage every text and element on your homepage</p>
                </div>

                <div class="card">
                    <h3>ðŸŽ¯ Hero Section</h3>
                    <div class="form-group">
                        <label>Badge Text</label>
                        <input type="text" id="heroBadge" value="âœ¦ Premium 3D Visualization">
                    </div>
                    <div class="form-group">
                        <label>Heading Line 1</label>
                        <input type="text" id="heroLine1" value="High-Quality Architectural">
                    </div>
                    <div class="form-group">
                        <label>Heading Line 2</label>
                        <input type="text" id="heroLine2" value="Visualization that">
                    </div>
                    <div class="form-group">
                        <label>Heading Line 3 (Gold)</label>
                        <input type="text" id="heroLine3" value="Helps Architects Win Clients">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="heroDesc"
                            rows="2">We transform your architectural concepts into stunning photorealistic renders that captivate your clients and close deals faster.</textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Button 1 Text</label>
                            <input type="text" id="heroBtn1" value="View Portfolio">
                        </div>
                        <div class="form-group">
                            <label>Button 2 Text</label>
                            <input type="text" id="heroBtn2" value="Get Free Quote">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ–¼ï¸ Hero Carousel Images (5 Slides)</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1rem;">Click any image to change it. These images
                        appear in the hero slideshow.</p>
                    <div class="image-grid">
                        <div class="image-slot" onclick="uploadHeroImage(1)">
                            <img src="assets/images/render2.jpg" alt="Hero 1" id="heroImage1Preview">
                            <div class="image-overlay">ðŸ“· Change</div>
                            <input type="file" id="heroImage1Input" accept="image/*" hidden
                                onchange="handleHeroImageChange(1, this)">
                        </div>
                        <div class="image-slot" onclick="uploadHeroImage(2)">
                            <img src="assets/images/render10.jpg" alt="Hero 2" id="heroImage2Preview">
                            <div class="image-overlay">ðŸ“· Change</div>
                            <input type="file" id="heroImage2Input" accept="image/*" hidden
                                onchange="handleHeroImageChange(2, this)">
                        </div>
                        <div class="image-slot" onclick="uploadHeroImage(3)">
                            <img src="assets/images/render3.jpg" alt="Hero 3" id="heroImage3Preview">
                            <div class="image-overlay">ðŸ“· Change</div>
                            <input type="file" id="heroImage3Input" accept="image/*" hidden
                                onchange="handleHeroImageChange(3, this)">
                        </div>
                        <div class="image-slot" onclick="uploadHeroImage(4)">
                            <img src="assets/images/render12.jpg" alt="Hero 4" id="heroImage4Preview">
                            <div class="image-overlay">ðŸ“· Change</div>
                            <input type="file" id="heroImage4Input" accept="image/*" hidden
                                onchange="handleHeroImageChange(4, this)">
                        </div>
                        <div class="image-slot" onclick="uploadHeroImage(5)">
                            <img src="assets/images/render21.jpg" alt="Hero 5" id="heroImage5Preview">
                            <div class="image-overlay">ðŸ“· Change</div>
                            <input type="file" id="heroImage5Input" accept="image/*" hidden
                                onchange="handleHeroImageChange(5, this)">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ† Services Preview Section</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Heading</label>
                            <input type="text" id="servicesHeading" value="Our Expertise">
                        </div>
                        <div class="form-group">
                            <label>Subheading</label>
                            <input type="text" id="servicesSubheading"
                                value="Tailored visualization solutions for architects, developers, and real estate professionals.">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ–¼ï¸ Portfolio Preview Section</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Heading</label>
                            <input type="text" id="portfolioHeading" value="Featured Projects">
                        </div>
                        <div class="form-group">
                            <label>Subheading</label>
                            <input type="text" id="portfolioSubheading"
                                value="A selection of our latest architectural visualizations.">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ’¡ Why RenderLine Section</h3>
                    <div class="form-group">
                        <label>Section Heading</label>
                        <input type="text" id="whyHeading" value="Why RenderLine?">
                    </div>
                    <div class="form-group">
                        <label>Point 1</label>
                        <input type="text" id="whyPoint1" value="Architect-first collaborative workflow">
                    </div>
                    <div class="form-group">
                        <label>Point 2</label>
                        <input type="text" id="whyPoint2" value="Realistic lighting & material accuracy">
                    </div>
                    <div class="form-group">
                        <label>Point 3</label>
                        <input type="text" id="whyPoint3" value="Industry-leading software & techniques">
                    </div>
                    <div class="form-group">
                        <label>Point 4</label>
                        <input type="text" id="whyPoint4" value="Fast revisions & project confidentiality">
                    </div>
                    <div class="form-group">
                        <label>Point 5</label>
                        <input type="text" id="whyPoint5" value="Affordable pricing, premium results">
                    </div>
                    <div class="form-group">
                        <label>Button Text</label>
                        <input type="text" id="whyBtn" value="Start Your Project">
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸš€ CTA Section</h3>
                    <div class="form-group">
                        <label>CTA Heading</label>
                        <input type="text" id="ctaHeading" value="Ready to Visualize Your Vision?">
                    </div>
                    <div class="form-group">
                        <label>CTA Text</label>
                        <textarea id="ctaText"
                            rows="2">Let's discuss your project. Get a free consultation and custom quote today.</textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Button 1 Text</label>
                            <input type="text" id="ctaBtn1" value="Contact Us">
                        </div>
                        <div class="form-group">
                            <label>WhatsApp Button Text</label>
                            <input type="text" id="ctaBtn2" value="WhatsApp: 0311-4544040">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveHomeContent()">ðŸ’¾ Save Home Page</button>
            </section>

            <!-- About Page Section -->
            <section id="section-about" class="section">
                <div class="page-header">
                    <h1>About Page Content</h1>
                    <p>Manage your complete about page</p>
                </div>

                <div class="card">
                    <h3>ðŸ‘¤ Profile Information</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="aboutName" value="Dilawar Ali">
                        </div>
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="aboutTitle" value="Founder & Creative Director">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Profile Photo</label>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="service-image-slot" onclick="uploadAboutImage()">
                                <img src="assets/images/dilawar-ali.jpg" alt="Profile" id="aboutImagePreview">
                                <div class="image-overlay">ðŸ“· Change</div>
                                <input type="file" id="aboutImageInput" accept="image/*" hidden
                                    onchange="handleAboutImageChange(this)">
                            </div>
                            <p style="color: var(--text-dim); font-size: 0.85rem;">Click to change your profile photo
                            </p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Bio Paragraph 1</label>
                        <textarea id="aboutBio1"
                            rows="3">Welcome to RenderLine â€“ where architectural dreams transform into breathtaking visual realities. I founded this studio with a singular vision: to bridge the gap between an architect's imagination and their client's understanding through the power of photorealistic visualization.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Bio Paragraph 2</label>
                        <textarea id="aboutBio2"
                            rows="3">With expertise spanning 3D modeling, V-Ray & Corona rendering, Lumion animations, and Unreal Engine real-time visualization, I deliver renders that don't just show spaces â€“ they evoke emotions.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Bio Paragraph 3</label>
                        <textarea id="aboutBio3"
                            rows="3">My deep understanding of the Saudi Arabian market â€“ from the majestic Najdi architecture of Riyadh to the coastal elegance of Jeddah â€“ enables me to create culturally resonant visualizations.</textarea>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ“Š Statistics</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Projects Completed</label>
                            <input type="text" id="statProjects" value="200+">
                        </div>
                        <div class="form-group">
                            <label>Happy Clients</label>
                            <input type="text" id="statClients" value="50+">
                        </div>
                        <div class="form-group">
                            <label>Years Experience</label>
                            <input type="text" id="statExperience" value="5+">
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸŽ¯ Areas of Expertise (8 Items)</h3>
                    <div class="form-row">
                        <div class="form-group"><input type="text" id="expertise1" value="Residential Exteriors"></div>
                        <div class="form-group"><input type="text" id="expertise2" value="Commercial Buildings"></div>
                        <div class="form-group"><input type="text" id="expertise3" value="Luxury Interiors"></div>
                        <div class="form-group"><input type="text" id="expertise4" value="Landscape Design"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><input type="text" id="expertise5" value="Aerial Views"></div>
                        <div class="form-group"><input type="text" id="expertise6" value="Night Renders"></div>
                        <div class="form-group"><input type="text" id="expertise7" value="3D Floor Plans"></div>
                        <div class="form-group"><input type="text" id="expertise8" value="Virtual Tours"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ› ï¸ Tools & Technologies (12 Items)</h3>
                    <div class="form-row">
                        <div class="form-group"><input type="text" id="tool1" value="3ds Max"></div>
                        <div class="form-group"><input type="text" id="tool2" value="SketchUp"></div>
                        <div class="form-group"><input type="text" id="tool3" value="V-Ray"></div>
                        <div class="form-group"><input type="text" id="tool4" value="Corona"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><input type="text" id="tool5" value="Lumion"></div>
                        <div class="form-group"><input type="text" id="tool6" value="D5 Render"></div>
                        <div class="form-group"><input type="text" id="tool7" value="Unreal Engine"></div>
                        <div class="form-group"><input type="text" id="tool8" value="Photoshop"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><input type="text" id="tool9" value="After Effects"></div>
                        <div class="form-group"><input type="text" id="tool10" value="AutoCAD"></div>
                        <div class="form-group"><input type="text" id="tool11" value="Revit"></div>
                        <div class="form-group"><input type="text" id="tool12" value="AI Tools"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸ“‹ How I Work (5 Steps)</h3>
                    <div class="form-group">
                        <label>Step 1 Title</label>
                        <input type="text" id="step1Title" value="Consultation">
                    </div>
                    <div class="form-group">
                        <label>Step 1 Description</label>
                        <textarea id="step1Desc"
                            rows="2">We discuss your project, deadlines, and specific requirements. I analyze your drawings to provide an accurate quote.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Step 2 Title</label>
                        <input type="text" id="step2Title" value="3D Modeling">
                    </div>
                    <div class="form-group">
                        <label>Step 2 Description</label>
                        <textarea id="step2Desc"
                            rows="2">I create an accurate 3D model based on your drawings. You receive a clay render for approval.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Step 3 Title</label>
                        <input type="text" id="step3Title" value="Materials & Lighting">
                    </div>
                    <div class="form-group">
                        <label>Step 3 Description</label>
                        <textarea id="step3Desc"
                            rows="2">Textures, materials, and lighting are applied. We agree on the atmosphere and mood.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Step 4 Title</label>
                        <input type="text" id="step4Title" value="Rendering">
                    </div>
                    <div class="form-group">
                        <label>Step 4 Description</label>
                        <textarea id="step4Desc"
                            rows="2">High-resolution photorealistic renders are produced using V-Ray or Corona.</textarea>
                    </div>
                    <div class="form-group">
                        <label>Step 5 Title</label>
                        <input type="text" id="step5Title" value="Revisions & Delivery">
                    </div>
                    <div class="form-group">
                        <label>Step 5 Description</label>
                        <textarea id="step5Desc"
                            rows="2">Final adjustments based on your feedback. Delivery in multiple formats.</textarea>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveAboutContent()">ðŸ’¾ Save About Page</button>
            </section>

            <!-- Portfolio Section -->
            <section id="section-portfolio" class="section">
                <div class="page-header">
                    <h1>Portfolio Management</h1>
                    <p>Upload and manage your portfolio renders - Direct to Cloudinary â˜ï¸</p>
                </div>

                <div class="card">
                    <h3>ðŸ“¤ Upload Portfolio Images to Cloudinary</h3>
                    <div class="form-group" style="margin-bottom: 1rem;">
                        <label
                            style="color: var(--gold); font-weight: 500; margin-bottom: 0.5rem; display: block;">Select
                            Upload Category</label>
                        <select id="portfolioCategoryUpload"
                            style="width: 100%; padding: 0.8rem; border-radius: 6px; border: 1px solid var(--border-gold); background: var(--bg-surface); color: var(--text-white); font-family: var(--font-body); font-size: 1rem; outline: none;">
                            <option value="exterior">Exterior Visualization</option>
                            <option value="interior">Interior Visualization</option>
                            <option value="commercial">Commercial</option>
                            <option value="floorplan">3D Floorplan</option>
                        </select>
                    </div>
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-icon">â˜ï¸</div>
                        <h4>Drag & Drop Images Here</h4>
                        <p style="color: var(--text-dim); margin-top: 0.5rem;">Images upload directly to Cloudinary
                            (auto-optimized)</p>
                        <input type="file" id="fileInput" accept="image/*" multiple hidden>
                    </div>
                    <div id="uploadProgress" style="margin-top: 1rem;"></div>
                </div>

                <div class="card">
                    <h3>ðŸ–¼ï¸ Your Portfolio (<span id="portfolioCount">0</span> images)</h3>
                    <div class="portfolio-grid" id="portfolioGrid">
                        <!-- Portfolio items will be loaded here -->
                        <p style="color: var(--text-dim); text-align: center; padding: 2rem;">Upload images to see them
                            here</p>
                    </div>
                </div>

                <div class="card">
                    <h3>ðŸŽ¬ Video Gallery (Unlimited)</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1rem;">Manage your YouTube/Vimeo videos. These will
                        appear in the Videos/Animations section.</p>

                    <div class="form-group"
                        style="padding: 1.5rem; background: var(--bg-dark); border-radius: 8px; border: 1px solid var(--border-light);">
                        <label>Add New Video</label>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <input type="text" id="newVideoUrl" placeholder="Paste YouTube URL here..."
                                style="flex: 2; min-width: 200px;" oninput="updateVideoPreview(this.value)">
                            <input type="text" id="newVideoTitle" placeholder="Video Title (Optional)"
                                style="flex: 1; min-width: 150px;">
                            <button class="btn btn-primary" onclick="addVideoItem()">âž• Add</button>
                        </div>
                        <div id="newVideoPreview"
                            style="margin-top: 1rem; display: none; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 8px;">
                        </div>
                    </div>

                    <div id="videoGalleryList" style="margin-top: 1.5rem; display: grid; gap: 1rem;">
                        <!-- Dynamic List -->
                        <p style="text-align: center; color: var(--text-dim);">Loading videos...</p>
                    </div>
                </div>

                <div class="card">
                    <h3>â˜ï¸ Direct Upload to Cloudinary</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1rem;">Click any image to upload directly. Images
                        auto-optimize and save.</p>

                    <h4 style="margin-bottom: 1rem; color: var(--gold);">Hero Carousel Images</h4>
                    <div class="image-grid" style="margin-bottom: 1.5rem;">
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 1)">
                            <img src="assets/images/render2.jpg" alt="Hero 1" id="cloudHero1Preview">
                            <div class="image-overlay">ðŸ“¤ Upload</div>
                            <input type="file" id="cloudHero1Input" accept="image/*" hidden
                                onchange="handleCloudinaryUpload('hero', 1, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 2)">
                            <img src="assets/images/render10.jpg" alt="Hero 2" id="cloudHero2Preview">
                            <div class="image-overlay">ðŸ“¤ Upload</div>
                            <input type="file" id="cloudHero2Input" accept="image/*" hidden
                                onchange="handleCloudinaryUpload('hero', 2, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 3)">
                            <img src="assets/images/render3.jpg" alt="Hero 3" id="cloudHero3Preview">
                            <div class="image-overlay">ðŸ“¤ Upload</div>
                            <input type="file" id="cloudHero3Input" accept="image/*" hidden
                                onchange="handleCloudinaryUpload('hero', 3, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 4)">
                            <img src="assets/images/render12.jpg" alt="Hero 4" id="cloudHero4Preview">
                            <div class="image-overlay">ðŸ“¤ Upload</div>
                            <input type="file" id="cloudHero4Input" accept="image/*" hidden
                                onchange="handleCloudinaryUpload('hero', 4, this)">
                        </div>
                        <div class="image-slot" onclick="uploadCloudinaryImage('hero', 5)">
                            <img src="assets/images/render21.jpg" alt="Hero 5" id="cloudHero5Preview">
                            <div class="image-overlay">ðŸ“¤ Upload</div>
                            <input type="file" id="cloudHero5Input" accept="image/*" hidden
                                onchange="handleCloudinaryUpload('hero', 5, this)">
                        </div>
                    </div>

                    <div id="uploadStatus" style="padding: 0.5rem; border-radius: 6px; display: none;"></div>
                </div>
            </section>

            <!-- Services Section -->
            <section id="section-services" class="section">
                <div class="page-header">
                    <h1>Services Management</h1>
                    <p>Edit all 6 services on your website</p>
                </div>

                <div class="card">
                    <h3>ðŸ“„ Services Page Header</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Page Heading</label>
                            <input type="text" id="servicesPageHeading" value="Our Services">
                        </div>
                        <div class="form-group">
                            <label>Page Subheading</label>
                            <input type="text" id="servicesPageSubheading"
                                value="Premium architectural visualization solutions tailored to bring your vision to life.">
                        </div>
                    </div>
                </div>

                <!-- Service 1 -->
                <div class="card">
                    <h3>ðŸ¢ Service 1: Exterior Visualization</h3>
                    <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
                        <div class="service-image-slot" onclick="uploadServiceImage(1)">
                            <img src="assets/images/render2.jpg" alt="Service 1" id="service1ImagePreview">
                            <div class="image-overlay">ðŸ“·</div>
                            <input type="file" id="service1ImageInput" accept="image/*" hidden
                                onchange="handleServiceImageChange(1, this)">
                        </div>
                        <div style="flex: 1; min-width: 300px;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Title</label>
                                    <input type="text" id="service1Title" value="Exterior Visualization">
                                </div>
                                <div class="form-group">
                                    <label>Icon</label>
                                    <input type="text" id="service1Icon" value="ðŸ¢" style="width: 60px;">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description</label>
                                <textarea id="service1Short"
                                    rows="2">Transform your building designs into stunning, photorealistic exterior renders.</textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Timeline</label>
                                    <input type="text" id="service1Timeline" value="3-5 business days">
                                </div>
                                <div class="form-group"><label>Price From</label>
                                    <input type="text" id="service1Price" value="$150">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Features (Comma Separated)</label>
                                <textarea id="service1Features" rows="3"
                                    placeholder="High Resolution, 3 Revisions..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
    </div>

    <!-- Service 2 -->
    <div class="card">
        <h3>ðŸ›‹ï¸ Service 2: Interior Visualization</h3>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div class="service-image-slot" onclick="uploadServiceImage(2)">
                <img src="assets/images/render10.jpg" alt="Service 2" id="service2ImagePreview">
                <div class="image-overlay">ðŸ“·</div>
                <input type="file" id="service2ImageInput" accept="image/*" hidden
                    onchange="handleServiceImageChange(2, this)">
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div class="form-row">
                    <div class="form-group"><label>Title</label><input type="text" id="service2Title"
                            value="Interior Visualization"></div>
                    <div class="form-group"><label>Icon</label><input type="text" id="service2Icon" value="ðŸ›‹ï¸"
                            style="width: 60px;"></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="service2Short"
                        rows="2">Showcase interiors with realistic lighting, materials, and furniture placement.</textarea>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Timeline</label><input type="text" id="service2Timeline"
                            value="2-4 business days"></div>
                    <div class="form-group"><label>Price</label><input type="text" id="service2Price" value="$120">
                    </div>
                </div>
                <div class="form-group">
                    <label>Features (Comma Separated)</label>
                    <textarea id="service2Features" rows="3" placeholder="High Resolution, 3 Revisions..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Service 3 -->
    <div class="card">
        <h3>ðŸŽ¬ Service 3: 3D Animations</h3>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div class="service-image-slot" onclick="uploadServiceImage(3)">
                <img src="assets/images/render12.jpg" alt="Service 3" id="service3ImagePreview">
                <div class="image-overlay">ðŸ“·</div>
                <input type="file" id="service3ImageInput" accept="image/*" hidden
                    onchange="handleServiceImageChange(3, this)">
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div class="form-row">
                    <div class="form-group"><label>Title</label><input type="text" id="service3Title"
                            value="3D Animations & Walkthroughs"></div>
                    <div class="form-group"><label>Icon</label><input type="text" id="service3Icon" value="ðŸŽ¬"
                            style="width: 60px;"></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="service3Short"
                        rows="2">Cinematic walkthrough animations for real estate marketing.</textarea>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Timeline</label><input type="text" id="service3Timeline"
                            value="7-14 business days"></div>
                    <div class="form-group"><label>Price</label><input type="text" id="service3Price" value="$500">
                    </div>
                </div>
                <div class="form-group">
                    <label>Features (Comma Separated)</label>
                    <textarea id="service3Features" rows="3" placeholder="High Resolution, 3 Revisions..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Service 4 -->
    <div class="card">
        <h3>ðŸ“ Service 4: Floor Plan Visualization</h3>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div class="service-image-slot" onclick="uploadServiceImage(4)">
                <img src="assets/images/render21.jpg" alt="Service 4" id="service4ImagePreview">
                <div class="image-overlay">ðŸ“·</div>
                <input type="file" id="service4ImageInput" accept="image/*" hidden
                    onchange="handleServiceImageChange(4, this)">
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div class="form-row">
                    <div class="form-group"><label>Title</label><input type="text" id="service4Title"
                            value="Floor Plan Visualization"></div>
                    <div class="form-group"><label>Icon</label><input type="text" id="service4Icon" value="ðŸ“"
                            style="width: 60px;"></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="service4Short"
                        rows="2">2D CAD to 3D floor plan conversion with furniture layout.</textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Timeline</label><input type="text" id="service4Timeline"
                            value="1-2 business days"></div>
                    <div class="form-group"><label>Price</label><input type="text" id="service4Price" value="$50"></div>
                </div>
                <div class="form-group">
                    <label>Features (Comma Separated)</label>
                    <textarea id="service4Features" rows="3" placeholder="High Resolution, 3 Revisions..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Service 5 -->
    <div class="card">
        <h3>ðŸ“ Service 5: AutoCAD Drawings</h3>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div class="service-image-slot" onclick="uploadServiceImage(5)">
                <img src="assets/images/render3.jpg" alt="Service 5" id="service5ImagePreview">
                <div class="image-overlay">ðŸ“·</div>
                <input type="file" id="service5ImageInput" accept="image/*" hidden
                    onchange="handleServiceImageChange(5, this)">
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div class="form-row">
                    <div class="form-group"><label>Title</label><input type="text" id="service5Title"
                            value="AutoCAD Drawings"></div>
                    <div class="form-group"><label>Icon</label><input type="text" id="service5Icon" value="ðŸ“"
                            style="width: 60px;"></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="service5Short"
                        rows="2">Professional 2D drafting and technical drawings.</textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Timeline</label><input type="text" id="service5Timeline"
                            value="2-5 business days"></div>
                    <div class="form-group"><label>Price</label><input type="text" id="service5Price" value="$80"></div>
                </div>
                <div class="form-group">
                    <label>Features (Comma Separated)</label>
                    <textarea id="service5Features" rows="3" placeholder="High Resolution, 3 Revisions..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Service 6 -->
    <div class="card">
        <h3>ðŸ’¡ Service 6: Design Consultation</h3>
        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap;">
            <div class="service-image-slot" onclick="uploadServiceImage(6)">
                <img src="assets/images/render4.jpg" alt="Service 6" id="service6ImagePreview">
                <div class="image-overlay">ðŸ“·</div>
                <input type="file" id="service6ImageInput" accept="image/*" hidden
                    onchange="handleServiceImageChange(6, this)">
            </div>
            <div style="flex: 1; min-width: 300px;">
                <div class="form-row">
                    <div class="form-group"><label>Title</label><input type="text" id="service6Title"
                            value="Design & Construction Consultation"></div>
                    <div class="form-group"><label>Icon</label><input type="text" id="service6Icon" value="ðŸ’¡"
                            style="width: 60px;"></div>
                </div>
                <div class="form-group"><label>Description</label><textarea id="service6Short"
                        rows="2">Expert guidance from concept to completion.</textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>Timeline</label><input type="text" id="service6Timeline"
                            value="Flexible"></div>
                    <div class="form-group"><label>Price</label><input type="text" id="service6Price" value="$100/hour">
                    </div>
                </div>
                <div class="form-group">
                    <label>Features (Comma Separated)</label>
                    <textarea id="service6Features" rows="3" placeholder="High Resolution, 3 Revisions..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <button class="btn btn-primary" onclick="saveServices()">ðŸ’¾ Save All Services</button>
    </section>

    <!-- Messages Section -->
    <section id="section-messages" class="section">
        <div class="page-header">
            <h1>Contact Messages</h1>
            <p>View and manage customer inquiries</p>
        </div>

        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Project Type</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="messagesTable">
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem;">No messages yet</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Contact Page Section -->
    <section id="section-contact" class="section">
        <div class="page-header">
            <h1>Contact Page Content</h1>
            <p>Edit your contact page text and information</p>
        </div>

        <div class="card">
            <h3>ðŸ“„ Page Header</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Heading</label>
                    <input type="text" id="contactHeading" value="Get In Touch">
                </div>
                <div class="form-group">
                    <label>Subheading</label>
                    <input type="text" id="contactSubheading"
                        value="Ready to bring your architectural vision to life? Let's discuss your project.">
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ðŸ“§ Contact Information</h3>
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="contactEmail" value="inforenderline@gmail.com">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>WhatsApp Number (with country code)</label>
                    <input type="text" id="contactWhatsapp" value="923114544040">
                </div>
                <div class="form-group">
                    <label>Phone Display Format</label>
                    <input type="text" id="contactPhoneDisplay" value="0311-4544040">
                </div>
            </div>
            <div class="form-group">
                <label>Location</label>
                <input type="text" id="contactLocation" value="Lahore, Pakistan">
            </div>
        </div>

        <button class="btn btn-primary" onclick="saveContactContent()">ðŸ’¾ Save Contact Page</button>
    </section>

    <!-- Footer Section -->
    <section id="section-footer" class="section">
        <div class="page-header">
            <h1>Footer Content</h1>
            <p>Edit footer that appears on all pages</p>
        </div>

        <div class="card">
            <h3>ðŸ·ï¸ Brand Section</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Brand Name</label>
                    <input type="text" id="footerBrand" value="RenderLine.">
                </div>
                <div class="form-group">
                    <label>Tagline</label>
                    <input type="text" id="footerTagline" value="Premium Architectural Visualization">
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ðŸ“ Footer Contact Info</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Address/City</label>
                    <input type="text" id="footerAddress" value="Lahore, Pakistan">
                </div>
                <div class="form-group">
                    <label>Phone Display</label>
                    <input type="text" id="footerPhone" value="0311-4544040">
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Â©ï¸ Copyright</h3>
            <div class="form-group">
                <label>Copyright Text</label>
                <input type="text" id="footerCopyright" value="Â© 2024 RenderLine. All Rights Reserved.">
            </div>
        </div>

        <button class="btn btn-primary" onclick="saveFooterContent()">ðŸ’¾ Save Footer</button>
    </section>

    <!-- Settings Section -->
    <section id="section-settings" class="section">
        <div class="page-header">
            <h1>Site Settings</h1>
            <p>Configure your website settings</p>
        </div>

        <div class="card">
            <h3>ðŸ“§ Contact Information</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="contactEmail" placeholder="info@renderline.com">
                </div>
                <div class="form-group">
                    <label>WhatsApp (with country code)</label>
                    <input type="text" id="contactWhatsapp" placeholder="923114544040">
                </div>
            </div>
            <div class="form-group">
                <label>Location</label>
                <input type="text" id="contactLocation" placeholder="Lahore, Pakistan">
            </div>
        </div>

        <div class="card">
            <h3>ðŸ”— Supabase Connection</h3>
            <div id="connectionStatus">
                <p style="color: var(--text-dim);">Checking connection...</p>
            </div>
        </div>

        <div class="card">
            <h3>â˜ï¸ Cloudinary Settings</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Cloud Name</label>
                    <input type="text" id="cloudName" value="dzp70azv3" readonly style="background: var(--bg-dark);">
                </div>
                <div class="form-group">
                    <label>Upload Preset Name</label>
                    <input type="text" id="cloudPreset" value="renderline_unsigned" placeholder="renderline_unsigned">
                </div>
            </div>
            <p style="color: var(--text-dim); font-size: 0.85rem; margin-top: 0.5rem;">
                âš¡ <strong>Important:</strong> Cloudinary Dashboard â†’ Settings â†’ Upload â†’ Add preset â†’ Set
                "Unsigned"
            </p>
        </div>

        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>

        <div class="card" style="margin-top: 2rem; border-color: var(--gold);">
            <h3>ðŸ› ï¸ Data Migration Tools</h3>
            <p style="color: var(--text-dim); margin-bottom: 1rem;">Use these if you lost videos during the
                update.</p>
            <button class="btn" onclick="restoreLegacyVideos()"
                style="width: 100%; border: 1px solid var(--gold); background: transparent; color: var(--gold);">â†»
                Restore Legacy YouTube Videos</button>
            <button class="btn" id="migrateBtn" onclick="migrateLocalAssets()"
                style="width: 100%; border: 1px solid var(--gold); background: transparent; color: var(--gold); margin-top: 1rem;">â˜ï¸
                Migrate Local Assets to Cloud</button>
            <div id="migrationLog"
                style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-dim); max-height: 150px; overflow-y: auto;">
            </div>
        </div>
    </section>

    </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js?v=3.0"></script>
    <script src="cloudinary-config.js?v=2.0"></script>

    <script>
        // ========== GLOBAL STATE ==========
        let currentUser = null;

        // ========== DEBUG: Check dependencies at startup ==========
        console.log('ðŸ” Admin Panel Dependencies Check:');
        console.log('  ðŸ“¦ window.supabase:', typeof window.supabase !== 'undefined' ? 'âœ… Loaded' : 'âŒ Not loaded');
        console.log('  ðŸ“¦ supabase client:', typeof supabase !== 'undefined' ? 'âœ… Initialized' : 'âŒ Not initialized');
        console.log('  ðŸ“¦ isSupabaseConfigured:', typeof isSupabaseConfigured === 'function' ? 'âœ… Available' : 'âŒ Not available');
        console.log('  ðŸ“¦ uploadToCloudinary:', typeof uploadToCloudinary === 'function' ? 'âœ… Available' : 'âŒ Not available');
        console.log('  ðŸ“¦ addPortfolioItem:', typeof addPortfolioItem === 'function' ? 'âœ… Available' : 'âŒ Not available');

        if (typeof isSupabaseConfigured === 'function') {
            console.log('  ðŸ”Œ Supabase configured:', isSupabaseConfigured() ? 'âœ… Yes' : 'âŒ No');
        }

        // ========== LOGIN ==========
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const btnText = document.getElementById('loginBtnText');

            btnText.textContent = 'Signing in...';
            errorDiv.classList.remove('show');

            if (typeof isSupabaseConfigured === 'function' && isSupabaseConfigured()) {
                const { data, error } = await adminLogin(email, password);
                if (error) {
                    errorDiv.textContent = error.message;
                    errorDiv.classList.add('show');
                    btnText.textContent = 'Sign In';
                } else {
                    showAdmin(data.user);
                }
            } else {
                // Demo mode
                setTimeout(() => {
                    showAdmin({ email: email });
                }, 1000);
            }
        });

        function showAdmin(user) {
            currentUser = user;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('adminPanel').classList.add('active');
            document.getElementById('userEmail').textContent = user.email;
            loadDashboardData();
        }

        async function logout() {
            if (typeof adminLogout === 'function') {
                await adminLogout();
            }
            location.reload();
        }

        // ========== NAVIGATION ==========
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const section = item.dataset.section;
                switchSection(section);
            });
        });

        function switchSection(sectionName) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sectionName) {
                    item.classList.add('active');
                }
            });

            // Update sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('section-' + sectionName).classList.add('active');
        }

        // ========== DATA LOADING ==========
        async function loadDashboardData() {
            let portfolioItems = [];

            // Try to load Portfolio from Supabase first (Cloud storage)
            if (typeof getPortfolioItems === 'function' && isSupabaseConfigured()) {
                const { data: cloudItems, error } = await getPortfolioItems();
                if (cloudItems && cloudItems.length > 0) {
                    portfolioItems = cloudItems;
                    console.log('Portfolio loaded from Supabase:', portfolioItems.length, 'items');
                } else {
                    // Fallback to localStorage
                    portfolioItems = JSON.parse(localStorage.getItem('portfolio_items') || '[]');
                    console.log('Portfolio loaded from localStorage:', portfolioItems.length, 'items');
                }
            } else {
                // Fallback to localStorage
                portfolioItems = JSON.parse(localStorage.getItem('portfolio_items') || '[]');
            }

            document.getElementById('statPortfolio').textContent = portfolioItems.length;
            document.getElementById('portfolioCount').textContent = portfolioItems.length;
            renderPortfolioGrid(portfolioItems);

            // Load Messages from Supabase
            if (typeof getContactMessages === 'function' && isSupabaseConfigured()) {
                const { data: messages } = await getContactMessages();
                const newMessages = messages ? messages.filter(m => m.status === 'new').length : 0;
                document.getElementById('statMessages').textContent = newMessages;
                renderMessagesTable(messages || []);

                // Load site content for forms
                const { data: content } = await getSiteContent();
                if (content) {
                    document.getElementById('heroHeading').value = content.hero_heading || '';
                    document.getElementById('heroSubheading').value = content.hero_subheading || '';
                    document.getElementById('whyHeading').value = content.why_heading || 'Why RenderLine?';
                    document.getElementById('ctaHeading').value = content.cta_heading || '';
                    document.getElementById('ctaText').value = content.cta_text || '';
                    document.getElementById('aboutName').value = content.about_name || '';
                    document.getElementById('aboutTitle').value = content.about_title || '';
                    document.getElementById('aboutBio').value = content.about_bio || '';
                    document.getElementById('statProjects').value = content.stat_projects || '';
                    document.getElementById('statClients').value = content.stat_clients || '';
                    document.getElementById('statExperience').value = content.stat_experience || '';
                    document.getElementById('contactEmail').value = content.contact_email || '';
                    document.getElementById('contactWhatsapp').value = content.contact_whatsapp || '';
                    document.getElementById('contactLocation').value = content.contact_location || '';
                }

                document.getElementById('connectionStatus').innerHTML = '<p style="color: var(--success);">âœ… Connected (Cloudinary + Supabase)</p>';
            } else {
                document.getElementById('connectionStatus').innerHTML = '<p style="color: var(--gold);">â˜ï¸ Using Cloudinary (Local Mode)</p>';
            }
        }

        function renderPortfolioGrid(items) {
            const grid = document.getElementById('portfolioGrid');
            grid.innerHTML = '';

            if (items.length === 0) {
                grid.innerHTML = '<p style="color: var(--text-dim); grid-column: 1/-1; text-align: center; padding: 2rem;">No portfolio items yet. Upload some images!</p>';
                return;
            }

            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'portfolio-item-admin';
                div.innerHTML = `
                    <img src="${item.image_url}" alt="${item.title}">
                    <div class="overlay">
                        <button class="btn btn-danger" onclick="deletePortfolio(${item.id})">Delete</button>
                    </div>
                `;
                grid.appendChild(div);
            });
        }

        function renderMessagesTable(messages) {
            const tbody = document.getElementById('messagesTable');
            tbody.innerHTML = '';

            if (messages.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No messages yet</td></tr>';
                return;
            }

            messages.forEach(msg => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${msg.name}</td>
                    <td><a href="mailto:${msg.email}" style="color: var(--gold);">${msg.email}</a></td>
                    <td>${msg.project_type || '-'}</td>
                    <td>${new Date(msg.created_at).toLocaleDateString()}</td>
                    <td><span class="badge badge-${msg.status}">${msg.status}</span></td>
                    <td>
                        <div style="display:flex; gap:0.5rem;">
                            <a href="https://wa.me/${msg.phone}" target="_blank" class="btn" style="padding: 0.4rem 0.6rem; font-size: 0.8rem; background: #25D366; color: white; text-decoration: none;" title="Reply via WhatsApp">WhatsApp</a>
                            <a href="mailto:${msg.email}" class="btn" style="padding: 0.4rem 0.6rem; font-size: 0.8rem; background: var(--primary); color: white; text-decoration: none;" title="Reply via Email">Email</a>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ========== SAVE FUNCTIONS ==========
        async function saveHomeContent() {
            const content = {
                hero_badge: document.getElementById('heroBadge').value,
                hero_line1: document.getElementById('heroLine1').value,
                hero_line2: document.getElementById('heroLine2').value,
                hero_line3: document.getElementById('heroLine3').value,
                hero_description: document.getElementById('heroDesc').value,
                hero_btn1_text: document.getElementById('heroBtn1').value,
                hero_btn2_text: document.getElementById('heroBtn2').value,
                services_heading: document.getElementById('servicesHeading').value,
                services_subheading: document.getElementById('servicesSubheading').value,
                portfolio_heading: document.getElementById('portfolioHeading').value,
                portfolio_subheading: document.getElementById('portfolioSubheading').value,
                why_heading: document.getElementById('whyHeading').value,
                why_point1: document.getElementById('whyPoint1').value,
                why_point2: document.getElementById('whyPoint2').value,
                why_point3: document.getElementById('whyPoint3').value,
                why_point4: document.getElementById('whyPoint4').value,
                why_point5: document.getElementById('whyPoint5').value,
                why_btn_text: document.getElementById('whyBtn').value,
                cta_heading: document.getElementById('ctaHeading').value,
                cta_text: document.getElementById('ctaText').value,
                cta_btn1_text: document.getElementById('ctaBtn1').value,
                cta_btn2_text: document.getElementById('ctaBtn2').value
            };

            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                const { error } = await updateSiteContent(content);
                alert(error ? 'âŒ Error: ' + error.message : 'âœ… Home page saved!');
            } else {
                alert('âš ï¸ Supabase not configured');
            }
        }

        async function saveAboutContent() {
            const content = {
                about_name: document.getElementById('aboutName').value,
                about_title: document.getElementById('aboutTitle').value,
                about_bio1: document.getElementById('aboutBio1').value,
                about_bio2: document.getElementById('aboutBio2').value,
                about_bio3: document.getElementById('aboutBio3').value,
                stat_projects: document.getElementById('statProjects').value,
                stat_clients: document.getElementById('statClients').value,
                stat_experience: document.getElementById('statExperience').value,
                expertise1: document.getElementById('expertise1').value,
                expertise2: document.getElementById('expertise2').value,
                expertise3: document.getElementById('expertise3').value,
                expertise4: document.getElementById('expertise4').value,
                expertise5: document.getElementById('expertise5').value,
                expertise6: document.getElementById('expertise6').value,
                expertise7: document.getElementById('expertise7').value,
                expertise8: document.getElementById('expertise8').value,
                tool1: document.getElementById('tool1').value,
                tool2: document.getElementById('tool2').value,
                tool3: document.getElementById('tool3').value,
                tool4: document.getElementById('tool4').value,
                tool5: document.getElementById('tool5').value,
                tool6: document.getElementById('tool6').value,
                tool7: document.getElementById('tool7').value,
                tool8: document.getElementById('tool8').value,
                tool9: document.getElementById('tool9').value,
                tool10: document.getElementById('tool10').value,
                tool11: document.getElementById('tool11').value,
                tool12: document.getElementById('tool12').value,
                step1_title: document.getElementById('step1Title').value,
                step1_desc: document.getElementById('step1Desc').value,
                step2_title: document.getElementById('step2Title').value,
                step2_desc: document.getElementById('step2Desc').value,
                step3_title: document.getElementById('step3Title').value,
                step3_desc: document.getElementById('step3Desc').value,
                step4_title: document.getElementById('step4Title').value,
                step4_desc: document.getElementById('step4Desc').value,
                step5_title: document.getElementById('step5Title').value,
                step5_desc: document.getElementById('step5Desc').value
            };

            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                const { error } = await updateSiteContent(content);
                alert(error ? 'âŒ Error: ' + error.message : 'âœ… About page saved!');
            } else {
                alert('âš ï¸ Supabase not configured');
            }
        }

        async function saveServices() {
            const content = {
                services_heading: document.getElementById('servicesPageHeading').value,
                services_subheading: document.getElementById('servicesPageSubheading').value
            };

            for (let i = 1; i <= 6; i++) {
                // Collect each service field
                // Ensure elements exist before accessing .value (though they should exist)
                const titleEl = document.getElementById('service' + i + 'Title');
                if (titleEl) content['service' + i + '_title'] = titleEl.value;

                const descEl = document.getElementById('service' + i + 'Short');
                if (descEl) content['service' + i + '_desc'] = descEl.value;

                const iconEl = document.getElementById('service' + i + 'Icon');
                if (iconEl) content['service' + i + '_icon'] = iconEl.value;

                const timeEl = document.getElementById('service' + i + 'Timeline');
                if (timeEl) content['service' + i + '_timeline'] = timeEl.value;

                const priceEl = document.getElementById('service' + i + 'Price');
                if (priceEl) content['service' + i + '_price'] = priceEl.value;

                const featuresEl = document.getElementById('service' + i + 'Features');
                if (featuresEl) content['service' + i + '_features'] = featuresEl.value;
            }

            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                const { error } = await updateSiteContent(content);
                if (error) {
                    console.error('DB Error:', error);
                    alert('âŒ DB Save Failed: ' + error.message + '\n\nPlease run "database-complete.sql" in Supabase!');
                } else {
                    alert('âœ… Services saved successfully!');
                }
            } else {
                alert('âš ï¸ Supabase not configured');
            }
        }

        async function saveContactContent() {
            const content = {
                contact_heading: document.getElementById('contactHeading').value,
                contact_subheading: document.getElementById('contactSubheading').value,
                contact_email: document.getElementById('contactEmail').value,
                contact_whatsapp: document.getElementById('contactWhatsapp').value,
                contact_phone_display: document.getElementById('contactPhoneDisplay').value,
                contact_location: document.getElementById('contactLocation').value
            };

            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                const { error } = await updateSiteContent(content);
                alert(error ? 'âŒ Error: ' + error.message : 'âœ… Contact page saved!');
            } else {
                alert('âš ï¸ Supabase not configured');
            }
        }

        async function saveFooterContent() {
            const content = {
                footer_brand: document.getElementById('footerBrand').value,
                footer_tagline: document.getElementById('footerTagline').value,
                footer_copyright: document.getElementById('footerCopyright').value
            };

            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                const { error } = await updateSiteContent(content);
                alert(error ? 'âŒ Error: ' + error.message : 'âœ… Footer saved!');
            } else {
                alert('âš ï¸ Supabase not configured');
            }
        }

        async function saveSettings() {
            const content = {
                contact_email: document.getElementById('contactEmail').value,
                contact_whatsapp: document.getElementById('contactWhatsapp').value,
                contact_location: document.getElementById('contactLocation').value
            };

            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                const { error } = await updateSiteContent(content);
                alert(error ? 'âŒ Error: ' + error.message : 'âœ… Settings saved!');
            } else {
                alert('âš ï¸ Supabase not configured');
            }
        }

        // ========== FILE UPLOAD ==========
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = 'var(--gold)';
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.style.borderColor = 'var(--border)';
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = 'var(--border)';
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        async function handleFiles(files) {
            const progressDiv = document.getElementById('uploadProgress');
            progressDiv.innerHTML = `<p style="color: var(--gold);">ðŸ“¤ Uploading ${files.length} file(s) to Cloudinary...</p>`;

            const portfolioItems = JSON.parse(localStorage.getItem('portfolio_items') || '[]');

            for (const file of files) {
                try {
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('upload_preset', CLOUDINARY_PRESET);
                    formData.append('folder', 'portfolio');

                    progressDiv.innerHTML += `<p>â³ Uploading ${file.name}...</p>`;

                    const response = await fetch(
                        `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD}/image/upload`,
                        { method: 'POST', body: formData }
                    );

                    const data = await response.json();

                    if (data.error) {
                        progressDiv.innerHTML += `<p style="color: var(--danger);">âŒ ${file.name}: ${data.error.message}</p>`;
                        progressDiv.innerHTML += `<p style="color: orange; font-size: 0.85rem;">âš ï¸ Make sure you created 'renderline_unsigned' upload preset in Cloudinary Dashboard â†’ Settings â†’ Upload â†’ Add upload preset â†’ Set to "Unsigned"</p>`;
                    } else {
                        const newItem = {
                            id: Date.now() + Math.random(),
                            title: file.name.replace(/\.[^/.]+$/, ''),
                            image_url: data.secure_url,
                            public_id: data.public_id,
                            category: document.getElementById('portfolioCategoryUpload').value || 'exterior',
                            uploaded_at: new Date().toISOString()
                        };

                        // Save to localStorage as backup
                        portfolioItems.push(newItem);

                        // Also save to Supabase database for cloud persistence
                        if (typeof addPortfolioItem === 'function' && isSupabaseConfigured()) {
                            const { error: dbError } = await addPortfolioItem({
                                title: newItem.title,
                                image_url: newItem.image_url,
                                public_id: newItem.public_id,
                                category: newItem.category
                            });
                            if (dbError) {
                                console.error('Supabase save error:', dbError);
                                progressDiv.innerHTML += `<p style="color: orange;">âš ï¸ ${file.name} uploaded to Cloudinary but cloud DB save failed</p>`;
                            } else {
                                progressDiv.innerHTML += `<p style="color: var(--success);">âœ… ${file.name} uploaded to Cloudinary + saved to cloud DB!</p>`;
                            }
                        } else {
                            progressDiv.innerHTML += `<p style="color: var(--success);">âœ… ${file.name} uploaded to Cloudinary!</p>`;
                        }
                    }
                } catch (error) {
                    progressDiv.innerHTML += `<p style="color: var(--danger);">âŒ ${file.name}: ${error.message}</p>`;
                }
            }

            // Save all to localStorage as backup
            localStorage.setItem('portfolio_items', JSON.stringify(portfolioItems));

            // Update grid
            renderPortfolioGrid(portfolioItems);
            document.getElementById('portfolioCount').textContent = portfolioItems.length;
            document.getElementById('statPortfolio').textContent = portfolioItems.length;

            fileInput.value = '';

            progressDiv.innerHTML += `<p style="color: var(--gold); margin-top: 1rem;">âœ¨ All uploads complete! Images saved to Cloudinary cloud storage.</p>`;
        }

        function deletePortfolio(id) {
            if (!confirm('Are you sure you want to delete this image?')) return;

            // Get from localStorage
            let portfolioItems = JSON.parse(localStorage.getItem('portfolio_items') || '[]');

            // Filter out the deleted item
            portfolioItems = portfolioItems.filter(item => item.id !== id);

            // Save back
            localStorage.setItem('portfolio_items', JSON.stringify(portfolioItems));

            // Update UI
            renderPortfolioGrid(portfolioItems);
            document.getElementById('portfolioCount').textContent = portfolioItems.length;
            document.getElementById('statPortfolio').textContent = portfolioItems.length;

            alert('âœ… Image deleted!');
        }

        // ========== HERO IMAGE UPLOAD ==========
        function uploadHeroImage(index) {
            document.getElementById('heroImage' + index + 'Input').click();
        }

        async function handleHeroImageChange(index, input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('heroImage' + index + 'Preview');

            // Show local preview immediately
            const reader = new FileReader();
            reader.onload = (e) => preview.src = e.target.result;
            reader.readAsDataURL(file);

            // Upload to Cloudinary (primary)
            if (typeof uploadToCloudinary === 'function') {
                alert('ðŸ“¤ Uploading hero image to Cloudinary...');
                const { data, error } = await uploadToCloudinary(file, 'hero');
                if (error) {
                    alert('âŒ Cloudinary upload failed: ' + error.message);
                    return;
                }

                preview.src = data.url;

                // Save URL to Supabase database
                if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                    const { error: dbError } = await updateSiteContent({ ['cloudinary_hero' + index]: data.url });
                    if (dbError) {
                        alert('âš ï¸ Uploaded to Cloudinary but DB save failed: ' + dbError.message);
                    } else {
                        alert('âœ… Hero image ' + index + ' uploaded to Cloudinary + saved to database!');
                    }
                } else {
                    // Save to localStorage as backup
                    const heroImages = JSON.parse(localStorage.getItem('hero_images') || '{}');
                    heroImages['hero_' + index] = data.url;
                    localStorage.setItem('hero_images', JSON.stringify(heroImages));
                    alert('âœ… Hero image ' + index + ' uploaded to Cloudinary! (Saved locally)');
                }
            } else {
                alert('âŒ Cloudinary not configured. Please check cloudinary-config.js');
            }
        }

        // ========== VIDEO MANAGEMENT ==========
        function uploadVideo(index) {
            document.getElementById('video' + index + 'Input').click();
        }

        async function handleVideoChange(index, input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('video' + index + 'Preview');
            preview.src = URL.createObjectURL(file);

            // Upload to Cloudinary
            if (typeof uploadVideoToCloudinary === 'function') {
                alert('ðŸ“¤ Uploading video to Cloudinary... This may take a moment for large files.');
                const { data, error } = await uploadVideoToCloudinary(file, 'videos');
                if (error) {
                    alert('âŒ Cloudinary upload failed: ' + error.message);
                    return;
                }

                preview.src = data.url;

                // Save URL to Supabase database
                if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                    const { error: dbError } = await updateSiteContent({ ['video_url' + index]: data.url });
                    if (dbError) {
                        alert('âš ï¸ Uploaded to Cloudinary but DB save failed: ' + dbError.message);
                    } else {
                        alert('âœ… Video ' + index + ' uploaded to Cloudinary + saved to database!');
                    }
                } else {
                    // Save to localStorage as backup
                    const videos = JSON.parse(localStorage.getItem('cloudinary_videos') || '{}');
                    videos['video_' + index] = data.url;
                    localStorage.setItem('cloudinary_videos', JSON.stringify(videos));
                    alert('âœ… Video ' + index + ' uploaded to Cloudinary! (Saved locally)');
                }
            } else {
                alert('âŒ Cloudinary video upload not available. Please check cloudinary-config.js');
            }
        }

        function removeVideo(index) {
            if (!confirm('Remove this video?')) return;
            const video = document.getElementById('video' + index + 'Preview');
            video.src = '';

            // Remove from localStorage
            const videos = JSON.parse(localStorage.getItem('cloudinary_videos') || '{}');
            delete videos['video_' + index];
            localStorage.setItem('cloudinary_videos', JSON.stringify(videos));

            // Remove from database if configured
            if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                updateSiteContent({ ['video_url' + index]: null });
            }

            alert('âœ… Video removed');
        }

        function addNewVideo() {
            alert('âž• Use the upload slots above to add videos!');
        }

        // ========== SERVICE IMAGE UPLOAD ==========
        function uploadServiceImage(index) {
            document.getElementById('service' + index + 'ImageInput').click();
        }

        async function handleServiceImageChange(index, input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('service' + index + 'ImagePreview');

            // Instant local preview
            const reader = new FileReader();
            reader.onload = (e) => preview.src = e.target.result;
            reader.readAsDataURL(file);

            // Upload to Cloudinary
            if (typeof uploadToCloudinary === 'function') {
                const { data, error } = await uploadToCloudinary(file, 'services');
                if (error) {
                    alert('âŒ Cloudinary upload failed: ' + error.message);
                    return;
                }

                preview.src = data.url;

                // Save to Supabase database
                if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                    const { error: dbError } = await updateSiteContent({ ['cloudinary_service' + index]: data.url });
                    if (dbError) {
                        console.error('DB Error:', dbError);
                        alert('âš ï¸ DB Save Failed: ' + dbError.message + '\n\nPlease go to Supabase SQL Editor and run the "database-complete.sql" script!');
                    } else {
                        alert('âœ… Service ' + index + ' image uploaded to Cloudinary + saved!');
                    }
                } else {
                    const serviceImages = JSON.parse(localStorage.getItem('service_images') || '{}');
                    serviceImages['service_' + index] = data.url;
                    localStorage.setItem('service_images', JSON.stringify(serviceImages));
                    alert('âœ… Service ' + index + ' image uploaded to Cloudinary! (Saved locally)');
                }
            } else {
                alert('âŒ Cloudinary not configured');
            }
        }

        // ========== ABOUT IMAGE UPLOAD ==========
        function uploadAboutImage() {
            document.getElementById('aboutImageInput').click();
        }

        async function handleAboutImageChange(input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('aboutImagePreview');
            const reader = new FileReader();
            reader.onload = (e) => preview.src = e.target.result;
            reader.readAsDataURL(file);

            // Upload to Cloudinary
            if (typeof uploadToCloudinary === 'function') {
                const { data, error } = await uploadToCloudinary(file, 'profile');
                if (error) {
                    alert('âŒ Cloudinary upload failed: ' + error.message);
                    return;
                }

                preview.src = data.url;

                // Save to Supabase database
                if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                    const { error: dbError } = await updateSiteContent({ about_image: data.url });
                    if (dbError) {
                        alert('âš ï¸ Uploaded to Cloudinary but DB save failed');
                    } else {
                        alert('âœ… Profile photo uploaded to Cloudinary + saved!');
                    }
                } else {
                    localStorage.setItem('about_image', data.url);
                    alert('âœ… Profile photo uploaded to Cloudinary! (Saved locally)');
                }
            } else {
                alert('âŒ Cloudinary not configured');
            }
        }

        // ========== VIDEO GALLERY FUNCTIONS (Dynamic) ==========
        function getYouTubeId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function updateVideoPreview(url) {
            const preview = document.getElementById('newVideoPreview');
            if (!preview) return;
            const videoId = getYouTubeId(url);

            if (videoId) {
                preview.style.display = 'block';
                preview.innerHTML = `
                    <p style="margin-bottom:0.5rem; color:var(--text-dim); font-size: 0.8rem;">Preview:</p>
                    <iframe width="100%" height="250" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen style="border-radius: 8px;"></iframe>
                `;
            } else {
                preview.style.display = 'none';
                preview.innerHTML = '';
            }
        }

        async function loadVideoGallery() {
            const container = document.getElementById('videoGalleryList');
            if (!container) return;

            container.innerHTML = '<p style="text-align:center">Loading...</p>';

            try {
                const { data, error } = await supabaseDb
                    .from('site_videos')
                    .select('*')
                    .order('sort_order', { ascending: true })
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    container.innerHTML = '<p style="text-align:center; color: var(--text-dim)">No videos added yet.</p>';
                    return;
                }

                container.innerHTML = '';
                data.forEach(video => {
                    const videoId = getYouTubeId(video.video_url);
                    const thumbUrl = videoId
                        ? `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`
                        : 'assets/images/placeholder.jpg';

                    const item = document.createElement('div');
                    item.className = 'portfolio-item';
                    item.style.display = 'flex';
                    item.style.alignItems = 'center';
                    item.style.gap = '1rem';
                    item.style.padding = '1rem';
                    item.style.background = 'var(--bg-card)';

                    item.innerHTML = `
                        <div style="width: 120px; height: 80px; flex-shrink: 0; position: relative; border-radius: 6px; overflow: hidden;">
                            <img src="${thumbUrl}" style="width: 100%; height: 100%; object-fit: cover;">
                            <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">â–¶ï¸</div>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin: 0; color: #fff; font-size: 1rem;">${video.title || 'Untitled'}</h4>
                            <a href="${video.video_url}" target="_blank" style="color: var(--primary); font-size: 0.85rem;">${video.video_url}</a>
                        </div>
                        <button class="btn-delete" onclick="deleteVideoItem('${video.id}')">ðŸ—‘ï¸</button>
                    `;
                    container.appendChild(item);
                });

            } catch (err) {
                console.error('Error loading videos:', err);
                container.innerHTML = '<p style="color:red">Failed to load videos.</p>';
            }
        }

        async function addVideoItem() {
            const urlInput = document.getElementById('newVideoUrl');
            const titleInput = document.getElementById('newVideoTitle');
            const url = urlInput.value.trim();
            const title = titleInput.value.trim();

            if (!url) {
                alert('Please enter a Video URL');
                return;
            }

            try {
                const { error } = await supabaseDb
                    .from('site_videos')
                    .insert([{ video_url: url, title: title }]);

                if (error) throw error;

                urlInput.value = '';
                titleInput.value = '';
                loadVideoGallery();
                alert('Video added successfully!');
            } catch (err) {
                console.error('Error adding video:', err);
                alert('Failed to add video: ' + err.message);
            }
        }

        async function deleteVideoItem(id) {
            if (!confirm('Are you sure you want to delete this video?')) return;

            try {
                const { error } = await supabaseDb
                    .from('site_videos')
                    .delete()
                    .eq('id', id);

                if (error) throw error;
                loadVideoGallery();
            } catch (err) {
                console.error('Error deleting video:', err);
                alert('Failed to delete video.');
            }
        }

        // ========== CLOUDINARY DIRECT UPLOAD ==========
        const CLOUDINARY_CLOUD = 'dzp70azv3';
        const CLOUDINARY_PRESET = 'renderline_unsigned'; // You'll create this

        function uploadCloudinaryImage(type, index) {
            document.getElementById('cloud' + type.charAt(0).toUpperCase() + type.slice(1) + index + 'Input').click();
        }

        async function handleCloudinaryUpload(type, index, input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('cloud' + type.charAt(0).toUpperCase() + type.slice(1) + index + 'Preview');
            const statusDiv = document.getElementById('uploadStatus');

            // Show instant preview
            const reader = new FileReader();
            reader.onload = (e) => preview.src = e.target.result;
            reader.readAsDataURL(file);

            // Show uploading status
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(212, 175, 55, 0.1)';
            statusDiv.innerHTML = 'ðŸ“¤ Uploading to Cloudinary...';

            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CLOUDINARY_PRESET);
                formData.append('folder', type);

                const response = await fetch(
                    `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD}/image/upload`,
                    { method: 'POST', body: formData }
                );

                const data = await response.json();
                console.log('Cloudinary response:', data);

                if (data.error) {
                    statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                    statusDiv.innerHTML = `âŒ Error: ${data.error.message}. <br><small>Create upload preset in Cloudinary Settings â†’ Upload â†’ Add upload preset â†’ Set to Unsigned</small>`;
                    alert('âŒ Cloudinary error: ' + data.error.message);
                } else {
                    preview.src = data.secure_url;

                    // Save URL to localStorage immediately
                    const savedUrls = JSON.parse(localStorage.getItem('cloudinary_images') || '{}');
                    savedUrls[`${type}_${index}`] = data.secure_url;
                    localStorage.setItem('cloudinary_images', JSON.stringify(savedUrls));
                    console.log('Saved to localStorage:', savedUrls);

                    statusDiv.style.background = 'rgba(74, 222, 128, 0.1)';
                    statusDiv.innerHTML = `âœ… Uploaded! URL: <small>${data.secure_url.substring(0, 50)}...</small>`;

                    // Save to Supabase
                    if (typeof updateSiteContent === 'function' && isSupabaseConfigured()) {
                        const dbColumn = `cloudinary_${type}${index}`;
                        console.log('Saving to Supabase:', dbColumn, data.secure_url);
                        const { error: dbError } = await updateSiteContent({ [dbColumn]: data.secure_url });
                        if (dbError) {
                            console.error('Supabase save error:', dbError);
                            statusDiv.innerHTML += `<br><small style="color: orange;">âš ï¸ Cloud save failed: ${dbError.message}</small>`;
                        } else {
                            console.log('Saved to Supabase successfully');
                            statusDiv.innerHTML += `<br><small style="color: lime;">âœ“ Saved to cloud database</small>`;
                        }
                    }
                    alert('âœ… Image uploaded and saved!');
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                statusDiv.innerHTML = `âŒ Upload failed: ${error.message}`;
                alert('âŒ Upload failed: ' + error.message);
            }
        }

        // ========== MIGRATION TOOLS ==========
        async function restoreLegacyVideos() {
            if (!confirm('This will read old video slots (1-4) and add them to the new unlimited gallery. Continue?')) return;

            try {
                const { data: content, error } = await supabaseDb
                    .from('site_content')
                    .select('youtube_video1, youtube_video2, youtube_video3, youtube_video4')
                    .single();

                if (error) throw error;
                if (!content) {
                    alert('No legacy content found.');
                    return;
                }

                let count = 0;
                for (let i = 1; i <= 4; i++) {
                    const url = content['youtube_video' + i];
                    if (url && url.length > 10) {
                        await supabaseDb
                            .from('site_videos')
                            .insert([{
                                video_url: url,
                                title: `Restored Video ${i}`,
                                description: 'Restored from previous version'
                            }]);
                        count++;
                    }
                }

                alert(`Migration Complete! Restored ${count} videos. Check the Video Gallery.`);
                loadVideoGallery();

            } catch (err) {
                console.error('Migration failed:', err);
                alert('Migration failed: ' + err.message);
            }
        }

        const LOCAL_ASSETS = [
            'Comercial (1).jpg', 'Comercial (1).png', 'Comercial (2).jpg', 'Comercial (2).png', 'Comercial (3).jpg', 'Comercial (3).png', 'Comercial (4).png', 'Comercial (5).png', 'Comercial (6).png',
            'Exterior (1).jpg', 'Exterior (1).png', 'Exterior (2).jpg', 'Exterior (2).png', 'Exterior (3).jpg', 'Exterior (3).png', 'Exterior (4).jpg', 'Exterior (5).jpg', 'Exterior (6).jpg',
            'interior (1).jpg', 'interior (1).png', 'interior (2).jpg', 'interior (2).png', 'interior (3).jpg', 'interior (3).png', 'interior (4).jpg', 'interior (5).jpg', 'interior (6).jpg', 'interior (7).jpg', 'interior (8).jpg'
        ];

        async function migrateLocalAssets() {
            if (!confirm('This will upload all ' + LOCAL_ASSETS.length + ' local assets to Cloudinary and add them to your Portfolio. Continue?')) return;

            const btn = document.getElementById('migrateBtn');
            const log = document.getElementById('migrationLog');
            btn.disabled = true;
            log.innerHTML = 'Starting migration...<br>';
            let success = 0;

            for (const file of LOCAL_ASSETS) {
                try {
                    log.innerHTML += `Uploading ${file}... `;

                    // 1. Fetch File
                    const response = await fetch(`assets/images/${file}`);
                    if (!response.ok) {
                        log.innerHTML += `<span style="color:orange">Not Found (Skipped)</span><br>`;
                        continue;
                    }
                    const blob = await response.blob();
                    const fileObj = new File([blob], file, { type: blob.type });

                    // 2. Upload to Cloudinary
                    const { data, error } = await uploadToCloudinary(fileObj, 'portfolio');
                    if (error) throw error;

                    // 3. Determine Category
                    let category = 'exterior';
                    const lower = file.toLowerCase();
                    if (lower.includes('interior')) category = 'interior';
                    else if (lower.includes('comercial')) category = 'commercial';

                    // 4. Save to Supabase
                    const { error: dbError } = await addPortfolioItem({
                        title: file.split('.')[0],
                        image_url: data.secure_url,
                        public_id: data.public_id,
                        category: category
                    });

                    if (dbError) throw dbError;

                    log.innerHTML += `<span style="color:lime">Done</span><br>`;
                    success++;

                    // Scroll log
                    log.scrollTop = log.scrollHeight;

                } catch (e) {
                    console.error(e);
                    log.innerHTML += `<span style="color:red">Failed: ${e.message}</span><br>`;
                }
            }

            btn.disabled = false;
            log.innerHTML += `<br><strong>Migration Finished. ${success} assets migrated.</strong>`;
            alert('Migration finished!');
            renderPortfolioGrid(await getPortfolioItems());
        }

        function loadAllAdminFields(content) {
            // Load Services
            for (let i = 1; i <= 6; i++) {
                if (document.getElementById('service' + i + 'Title') && content['service' + i + '_title']) document.getElementById('service' + i + 'Title').value = content['service' + i + '_title'];
                if (document.getElementById('service' + i + 'Short') && content['service' + i + '_desc']) document.getElementById('service' + i + 'Short').value = content['service' + i + '_desc'];
                if (document.getElementById('service' + i + 'Icon') && content['service' + i + '_icon']) document.getElementById('service' + i + 'Icon').value = content['service' + i + '_icon'];
                if (document.getElementById('service' + i + 'Timeline') && content['service' + i + '_timeline']) document.getElementById('service' + i + 'Timeline').value = content['service' + i + '_timeline'];
                if (document.getElementById('service' + i + 'Price') && content['service' + i + '_price']) document.getElementById('service' + i + 'Price').value = content['service' + i + '_price'];
                if (document.getElementById('service' + i + 'Features') && content['service' + i + '_features']) document.getElementById('service' + i + 'Features').value = content['service' + i + '_features'];
            }
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            if (sidebar) sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');
        }

        // ========== AUTO LOGIN CHECK ==========
        document.addEventListener('DOMContentLoaded', async () => {
            if (typeof isSupabaseConfigured === 'function' && isSupabaseConfigured()) {
                const user = await getCurrentUser();
                if (user) {
                    showAdmin(user);
                }

                // Load dynamic video gallery
                loadVideoGallery();

                // Load other content if needed (Checking if other fields exist in this block)
                const { data: content } = await getSiteContent();
                if (content) {
                    // Legacy static video loading removed
                    // Check if about info needs loading here?
                    if (content.about_name && document.getElementById('aboutName')) {
                        document.getElementById('aboutName').value = content.about_name;
                        // Assume other fields might be here or loaded elsewhere
                        // I will trigger a general load if it exists
                    }
                    if (typeof loadAllAdminFields === 'function') loadAllAdminFields(content);
                }
            }
        });

    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // --- PREMIUM DASHBOARD ---

        let trafficChart, deviceChart;

        function initCharts() {
            const ctx1 = document.getElementById('trafficChart')?.getContext('2d');
            const ctx2 = document.getElementById('deviceChart')?.getContext('2d');

            if (ctx1) {
                trafficChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00', 'Now'],
                        datasets: [{
                            label: 'Visitors',
                            data: [12, 19, 8, 15, 20, 25, 45],
                            borderColor: '#D4AF37',
                            backgroundColor: 'rgba(212, 175, 55, 0.1)',
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#D4AF37',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#888' } },
                            x: { grid: { display: false }, ticks: { color: '#888' } }
                        }
                    }
                });
            }

            if (ctx2) {
                deviceChart = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Mobile', 'Desktop', 'Tablet'],
                        datasets: [{
                            data: [65, 30, 5],
                            backgroundColor: ['#D4AF37', '#222', '#666'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right', labels: { color: '#ccc', boxWidth: 10 } } }
                    }
                });
            }
        }

        function updateDashboardSimulations() {
            // Live Visitors Tick
            setInterval(() => {
                const el = document.getElementById('statVisitors');
                if (el) {
                    let current = parseInt(el.textContent) || 12;
                    let change = Math.floor(Math.random() * 3) - 1;
                    el.textContent = Math.max(5, current + change);
                }
            }, 3000);

            // Random Chart Update (Visual Effect)
            setInterval(() => {
                if (trafficChart) {
                    const data = trafficChart.data.datasets[0].data;
                    data[6] = parseInt(document.getElementById('statVisitors')?.textContent || 45);
                    trafficChart.update('none');
                }
            }, 3000);
        }

        // Init Charts when Dashboard becomes active
        document.addEventListener('DOMContentLoaded', () => {
            // Wait a moment for layout
            setTimeout(() => {
                initCharts();
                updateDashboardSimulations();
            }, 500);
        });

    </script>
</body>

</html>
